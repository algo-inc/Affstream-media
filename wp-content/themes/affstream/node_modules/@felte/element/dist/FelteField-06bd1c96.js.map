{"version":3,"file":"FelteField-06bd1c96.js","sources":["../src/FelteField.ts"],"sourcesContent":["import type { FieldValue } from '@felte/core';\nimport { createField } from '@felte/core';\n\nfunction failFor(name: string) {\n  return function () {\n    throw new TypeError(\n      `Can't call \"${name}\" on HTMLFelteFieldElement. The element is not ready yet.`\n    );\n  };\n}\n\nfunction booleanCoverter(value: string) {\n  return value === '' || (!!value && value !== 'false');\n}\n\nexport class FelteField<\n  Value extends FieldValue = FieldValue\n> extends HTMLElement {\n  [key: string]: unknown;\n  static get observedAttributes() {\n    return [\n      'name',\n      'touchonchange',\n      'valueprop',\n      'inputevent',\n      'blurevent',\n      'composed',\n      'value',\n      'target',\n    ];\n  }\n\n  /** @internal */\n  static get attributeMap(): Record<\n    string,\n    { converter: (v: any) => any; name: string }\n  > {\n    return {\n      name: {\n        converter: String,\n        name: 'name',\n      },\n      touchonchange: {\n        converter: booleanCoverter,\n        name: 'touchOnChange',\n      },\n      valueprop: {\n        converter: String,\n        name: 'valueProp',\n      },\n      inputevent: {\n        converter: String,\n        name: 'inputEvent',\n      },\n      blurevent: {\n        converter: String,\n        name: 'blurEvent',\n      },\n      value: {\n        converter: String,\n        name: 'value',\n      },\n      composed: {\n        converter: booleanCoverter,\n        name: 'composed',\n      },\n      target: {\n        converter: String,\n        name: 'target',\n      },\n    };\n  }\n\n  attributeChangedCallback(name: string, oldValue: any, newValue: any) {\n    if (oldValue === newValue) return;\n    const { converter, name: propName } = FelteField.attributeMap[name];\n    this[propName] = converter(newValue);\n  }\n\n  /**\n   * @attr\n   */\n  name?: string;\n\n  /**\n   * @attr touchonchange\n   */\n  touchOnChange = false;\n\n  /**\n   * @attr valueprop\n   */\n  valueProp = 'value';\n\n  /**\n   * @attr inputevent\n   */\n  inputEvent = 'input';\n\n  /**\n   * @attr blurevent\n   */\n  blurEvent = 'focusout';\n\n  /**\n   * @attr\n   */\n  composed = false;\n\n  /**\n   * @attr\n   */\n  target?: string;\n\n  /** @internal */\n  private _value?: Value;\n  set value(newValue: Value) {\n    this._onInput?.(newValue);\n    this._value = newValue;\n  }\n\n  /**\n   * @attr\n   */\n  get value() {\n    return this._value as Value;\n  }\n\n  /** @internal */\n  private _onInput?: (value: Value) => void;\n\n  /** @internal */\n  private _onBlur: () => void = failFor('blur');\n\n  blur() {\n    this._onBlur();\n  }\n\n  /** @internal */\n  private _destroy?: () => void;\n\n  /** @internal */\n  private _ready = false;\n  get ready() {\n    return this._ready;\n  }\n\n  onfeltefieldready?(): void;\n\n  /** @internal */\n  private _element?: HTMLElement;\n\n  /** @internal */\n  private _createField() {\n    const {\n      name,\n      inputEvent,\n      blurEvent,\n      touchOnChange,\n      value: defaultValue,\n      composed,\n    } = this;\n    if (!name) throw new Error('<felte-field> must have a \"name\" attribute');\n    const element = this._element;\n    if (!element) return;\n    (element as any)[this.valueProp] = defaultValue;\n\n    const { field, onInput, onBlur } = createField(name, {\n      touchOnChange,\n      defaultValue,\n      onFormReset: () => {\n        this.value = defaultValue;\n        (element as any)[this.valueProp] = defaultValue;\n      },\n    });\n    this._onInput = onInput;\n    this._onBlur = onBlur;\n    const { destroy } = field(element);\n    const handleInput = (e: Event) => {\n      const target = composed ? e.composedPath()[0] : (e.target as any);\n      this.value = target[this.valueProp];\n    };\n    const handleBlur = () => {\n      onBlur();\n    };\n    element.addEventListener(inputEvent, handleInput);\n    element.addEventListener(blurEvent, handleBlur);\n    this._destroy = () => {\n      destroy?.();\n      element.removeEventListener(inputEvent, handleInput);\n      element.removeEventListener(inputEvent, handleBlur);\n    };\n\n    this._ready = true;\n    this.onfeltefieldready?.();\n    this.dispatchEvent(new Event('feltefieldready'));\n  }\n\n  /** @internal */\n  private _updateField = () => {\n    const element = this.target\n      ? (this.querySelector(this.target) as HTMLElement | null)\n      : (this.firstElementChild as HTMLElement | null);\n    if (!element || element === this._element) return;\n    this._element = element;\n    this._destroy?.();\n    this._destroy = undefined;\n    this._createField();\n  };\n\n  /** @internal */\n  private _observer?: MutationObserver;\n\n  connectedCallback() {\n    setTimeout(() => {\n      this._updateField();\n      this._observer = new MutationObserver(this._updateField);\n      this._observer.observe(this, { childList: true });\n    });\n  }\n\n  disconnectedCallback() {\n    this._destroy?.();\n    this._observer?.disconnect();\n  }\n}\n"],"names":[],"mappings":";;AAGA,SAAS,OAAO,CAAC,IAAY,EAAA;IAC3B,OAAO,YAAA;AACL,QAAA,MAAM,IAAI,SAAS,CACjB,eAAe,IAAI,CAAA,yDAAA,CAA2D,CAC/E,CAAC;AACJ,KAAC,CAAC;AACJ,CAAC;AAED,SAAS,eAAe,CAAC,KAAa,EAAA;AACpC,IAAA,OAAO,KAAK,KAAK,EAAE,KAAK,CAAC,CAAC,KAAK,IAAI,KAAK,KAAK,OAAO,CAAC,CAAC;AACxD,CAAC;AAEK,MAAO,UAEX,SAAQ,WAAW,CAAA;AAFrB,IAAA,WAAA,GAAA;;AAqEE;;AAEG;QACH,IAAa,CAAA,aAAA,GAAG,KAAK,CAAC;AAEtB;;AAEG;QACH,IAAS,CAAA,SAAA,GAAG,OAAO,CAAC;AAEpB;;AAEG;QACH,IAAU,CAAA,UAAA,GAAG,OAAO,CAAC;AAErB;;AAEG;QACH,IAAS,CAAA,SAAA,GAAG,UAAU,CAAC;AAEvB;;AAEG;QACH,IAAQ,CAAA,QAAA,GAAG,KAAK,CAAC;;AAyBT,QAAA,IAAA,CAAA,OAAO,GAAe,OAAO,CAAC,MAAM,CAAC,CAAC;;QAUtC,IAAM,CAAA,MAAA,GAAG,KAAK,CAAC;;QAyDf,IAAY,CAAA,YAAA,GAAG,MAAK;;AAC1B,YAAA,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM;kBACtB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAwB;AACzD,kBAAG,IAAI,CAAC,iBAAwC,CAAC;AACnD,YAAA,IAAI,CAAC,OAAO,IAAI,OAAO,KAAK,IAAI,CAAC,QAAQ;gBAAE,OAAO;AAClD,YAAA,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AACxB,YAAA,CAAA,EAAA,GAAA,IAAI,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,IAAA,CAAI,CAAC;AAClB,YAAA,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;YAC1B,IAAI,CAAC,YAAY,EAAE,CAAC;AACtB,SAAC,CAAC;KAiBH;AA9MC,IAAA,WAAW,kBAAkB,GAAA;QAC3B,OAAO;YACL,MAAM;YACN,eAAe;YACf,WAAW;YACX,YAAY;YACZ,WAAW;YACX,UAAU;YACV,OAAO;YACP,QAAQ;SACT,CAAC;KACH;;AAGD,IAAA,WAAW,YAAY,GAAA;QAIrB,OAAO;AACL,YAAA,IAAI,EAAE;AACJ,gBAAA,SAAS,EAAE,MAAM;AACjB,gBAAA,IAAI,EAAE,MAAM;AACb,aAAA;AACD,YAAA,aAAa,EAAE;AACb,gBAAA,SAAS,EAAE,eAAe;AAC1B,gBAAA,IAAI,EAAE,eAAe;AACtB,aAAA;AACD,YAAA,SAAS,EAAE;AACT,gBAAA,SAAS,EAAE,MAAM;AACjB,gBAAA,IAAI,EAAE,WAAW;AAClB,aAAA;AACD,YAAA,UAAU,EAAE;AACV,gBAAA,SAAS,EAAE,MAAM;AACjB,gBAAA,IAAI,EAAE,YAAY;AACnB,aAAA;AACD,YAAA,SAAS,EAAE;AACT,gBAAA,SAAS,EAAE,MAAM;AACjB,gBAAA,IAAI,EAAE,WAAW;AAClB,aAAA;AACD,YAAA,KAAK,EAAE;AACL,gBAAA,SAAS,EAAE,MAAM;AACjB,gBAAA,IAAI,EAAE,OAAO;AACd,aAAA;AACD,YAAA,QAAQ,EAAE;AACR,gBAAA,SAAS,EAAE,eAAe;AAC1B,gBAAA,IAAI,EAAE,UAAU;AACjB,aAAA;AACD,YAAA,MAAM,EAAE;AACN,gBAAA,SAAS,EAAE,MAAM;AACjB,gBAAA,IAAI,EAAE,QAAQ;AACf,aAAA;SACF,CAAC;KACH;AAED,IAAA,wBAAwB,CAAC,IAAY,EAAE,QAAa,EAAE,QAAa,EAAA;QACjE,IAAI,QAAQ,KAAK,QAAQ;YAAE,OAAO;AAClC,QAAA,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;QACpE,IAAI,CAAC,QAAQ,CAAC,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC;KACtC;IAuCD,IAAI,KAAK,CAAC,QAAe,EAAA;;AACvB,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,QAAQ,MAAG,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,IAAA,EAAA,QAAQ,CAAC,CAAC;AAC1B,QAAA,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;KACxB;AAED;;AAEG;AACH,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAe,CAAC;KAC7B;IAQD,IAAI,GAAA;QACF,IAAI,CAAC,OAAO,EAAE,CAAC;KAChB;AAOD,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM,CAAC;KACpB;;IAQO,YAAY,GAAA;;AAClB,QAAA,MAAM,EACJ,IAAI,EACJ,UAAU,EACV,SAAS,EACT,aAAa,EACb,KAAK,EAAE,YAAY,EACnB,QAAQ,GACT,GAAG,IAAI,CAAC;AACT,QAAA,IAAI,CAAC,IAAI;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;AACzE,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;AAC9B,QAAA,IAAI,CAAC,OAAO;YAAE,OAAO;AACpB,QAAA,OAAe,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,YAAY,CAAC;QAEhD,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,WAAW,CAAC,IAAI,EAAE;YACnD,aAAa;YACb,YAAY;YACZ,WAAW,EAAE,MAAK;AAChB,gBAAA,IAAI,CAAC,KAAK,GAAG,YAAY,CAAC;AACzB,gBAAA,OAAe,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,YAAY,CAAC;aACjD;AACF,SAAA,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AACxB,QAAA,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,MAAM,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC;AACnC,QAAA,MAAM,WAAW,GAAG,CAAC,CAAQ,KAAI;AAC/B,YAAA,MAAM,MAAM,GAAG,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,GAAI,CAAC,CAAC,MAAc,CAAC;YAClE,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACtC,SAAC,CAAC;QACF,MAAM,UAAU,GAAG,MAAK;AACtB,YAAA,MAAM,EAAE,CAAC;AACX,SAAC,CAAC;AACF,QAAA,OAAO,CAAC,gBAAgB,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;AAClD,QAAA,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;AAChD,QAAA,IAAI,CAAC,QAAQ,GAAG,MAAK;AACnB,YAAA,OAAO,KAAP,IAAA,IAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,EAAI,CAAC;AACZ,YAAA,OAAO,CAAC,mBAAmB,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;AACrD,YAAA,OAAO,CAAC,mBAAmB,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;AACtD,SAAC,CAAC;AAEF,QAAA,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;AACnB,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,iBAAiB,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,IAAA,CAAI,CAAC;QAC3B,IAAI,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC;KAClD;IAiBD,iBAAiB,GAAA;QACf,UAAU,CAAC,MAAK;YACd,IAAI,CAAC,YAAY,EAAE,CAAC;YACpB,IAAI,CAAC,SAAS,GAAG,IAAI,gBAAgB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AACzD,YAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;AACpD,SAAC,CAAC,CAAC;KACJ;IAED,oBAAoB,GAAA;;AAClB,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,IAAA,CAAI,CAAC;AAClB,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,SAAS,MAAE,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,UAAU,EAAE,CAAC;KAC9B;AACF;;;;"}