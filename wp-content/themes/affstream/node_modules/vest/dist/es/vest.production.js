import{enforce as t}from"n4s";export{enforce}from"n4s";import{assign as e,tinyState as n,cache as s,isArray as r,isStringValue as i,asArray as a,hasOwnProperty as o,seq as u,StateMachine as c,invariant as l,isPromise as E,optionalFunctionValue as f,isEmpty as d,callEach as N,bindNot as T,either as S,isPositive as g,greaterThan as R,defaultTo as I,noop as _,isNotEmpty as m,isNotNullish as p,deferThrow as D,text as O,isUndefined as A,isNull as C,isFunction as v,numberEquals as h}from"vest-utils";import{Isolate as P,VestRuntime as L,IsolateSelectors as U,Walker as F,Bus as G,IsolateInspector as y,Reconciler as W}from"vestjs-runtime";import{createCascade as b}from"context";const M="Each",B="Focused",w="Group",k="OmitWhen",j="SkipWhen",K="Suite",V="Test";class H{static setOptionalField(t,n,s){const r=t.data.optional,i=r[n];e(r,{[n]:e({},i,s(i))})}static getOptionalField(t,e){var n;return null!==(n=t.data.optional[e])&&void 0!==n?n:{}}static getOptionalFields(t){return t.data.optional}}var X,x;!function(t){t[t.CUSTOM_LOGIC=0]="CUSTOM_LOGIC",t[t.AUTO=1]="AUTO"}(X||(X={})),function(t){t.EAGER="EAGER",t.ALL="ALL",t.ONE="ONE"}(x||(x={}));const q=b(((t,s)=>s?null:e({inclusion:{},mode:n.createTinyState(x.EAGER),suiteParams:[],testMemoCache:J},t)));function Y(){return q.useX().inclusion}function z(){return q.useX().mode()}const J=s(10);function Q(e){var n;const s=L.useAvailableRoot(),u=q.useX().suiteParams,c=null!==(n=null==u?void 0:u[0])&&void 0!==n?n:{};if(r(e)||i(e))a(e).forEach((e=>{H.setOptionalField(s,e,(()=>({type:X.AUTO,applied:!!o(c,e)&&t.isBlank().test(null==c?void 0:c[e]),rule:null})))}));else for(const n in e){const r=e[n];H.setOptionalField(s,n,(()=>({type:X.CUSTOM_LOGIC,rule:r,applied:t.isBlank().test(r)||!0===r})))}}function Z(t){var e,n;if(!t)return!1;const s=L.useAvailableRoot();return null!==(n=null===(e=H.getOptionalField(s,t))||void 0===e?void 0:e.applied)&&void 0!==n&&n}var $;!function(t){t.TEST_RUN_STARTED="test_run_started",t.TEST_COMPLETED="test_completed",t.ALL_RUNNING_TESTS_FINISHED="all_running_tests_finished",t.REMOVE_FIELD="remove_field",t.RESET_FIELD="reset_field",t.RESET_SUITE="reset_suite",t.SUITE_RUN_STARTED="suite_run_started",t.SUITE_CALLBACK_RUN_FINISHED="SUITE_CALLBACK_RUN_FINISHED",t.DONE_TEST_OMISSION_PASS="DONE_TEST_OMISSION_PASS"}($||($={}));const tt=s();function et(){return L.useXAppData()}function nt(){return et().doneCallbacks()}function st(){return et().fieldCallbacks()}function rt(){return et().suiteId}function it(){et().suiteResultCache.invalidate([rt()])}function at(){const[,,t]=nt(),[,,e]=st();t(),e()}function ot(t){L.useLoadRootNode(t),it()}var ut,ct;!function(t){t.UNTESTED="UNTESTED",t.SKIPPED="SKIPPED",t.FAILED="FAILED",t.WARNING="WARNING",t.PASSING="PASSING",t.PENDING="PENDING",t.CANCELED="CANCELED",t.OMITTED="OMITTED"}(ut||(ut={})),function(t){t.RESET="RESET"}(ct||(ct={}));const lt={initial:ut.UNTESTED,states:{"*":{[ut.OMITTED]:ut.OMITTED,[ct.RESET]:ut.UNTESTED},[ut.UNTESTED]:{[ut.CANCELED]:ut.CANCELED,[ut.FAILED]:ut.FAILED,[ut.PASSING]:ut.PASSING,[ut.PENDING]:ut.PENDING,[ut.SKIPPED]:ut.SKIPPED,[ut.WARNING]:ut.WARNING},[ut.PENDING]:{[ut.CANCELED]:ut.CANCELED,[ut.FAILED]:ut.FAILED,[ut.PASSING]:ut.PASSING,[ut.SKIPPED]:[ut.SKIPPED,t=>!0===t],[ut.WARNING]:ut.WARNING},[ut.SKIPPED]:{},[ut.FAILED]:{},[ut.WARNING]:{},[ut.PASSING]:{},[ut.CANCELED]:{},[ut.OMITTED]:{}}};var Et,ft,dt;function Nt(t){return t===Et.ERRORS?ft.ERROR_COUNT:ft.WARN_COUNT}!function(t){t.WARNINGS="warnings",t.ERRORS="errors"}(Et||(Et={})),function(t){t.ERROR_COUNT="errorCount",t.WARN_COUNT="warnCount"}(ft||(ft={})),function(t){t.Error="error",t.Warning="warning"}(dt||(dt={}));const Tt=c(lt);class St{static getData(t){return l(t.data),t.data}static warns(t){return St.getData(t).severity===dt.Warning}static isPending(t){return St.statusEquals(t,ut.PENDING)}static isOmitted(t){return St.statusEquals(t,ut.OMITTED)}static isUntested(t){return St.statusEquals(t,ut.UNTESTED)}static isFailing(t){return St.statusEquals(t,ut.FAILED)}static isCanceled(t){return St.statusEquals(t,ut.CANCELED)}static isSkipped(t){return St.statusEquals(t,ut.SKIPPED)}static isPassing(t){return St.statusEquals(t,ut.PASSING)}static isWarning(t){return St.statusEquals(t,ut.WARNING)}static hasFailures(t){return St.isFailing(t)||St.isWarning(t)}static isNonActionable(t){return St.isSkipped(t)||St.isOmitted(t)||St.isCanceled(t)}static isTested(t){return St.hasFailures(t)||St.isPassing(t)}static awaitsResolution(t){return St.isSkipped(t)||St.isUntested(t)||St.isPending(t)}static isAsyncTest(t){return E(St.getData(t).asyncTest)}static statusEquals(t,e){return St.getData(t).status===e}static setPending(t){St.setStatus(t,ut.PENDING)}static fail(t){St.setStatus(t,St.warns(t)?ut.WARNING:ut.FAILED)}static pass(t){St.setStatus(t,ut.PASSING)}static warn(t){St.setData(t,(t=>Object.assign(Object.assign({},t),{severity:dt.Warning})))}static setData(t,e){t.data=f(e,St.getData(t))}static skip(t,e){St.setStatus(t,ut.SKIPPED,e)}static cancel(t){St.setStatus(t,ut.CANCELED)}static omit(t){St.setStatus(t,ut.OMITTED)}static reset(t){St.setStatus(t,ct.RESET)}static setStatus(t,e,n){St.setData(t,(t=>Object.assign(Object.assign({},t),{status:Tt.staticTransition(t.status,e,n)})))}}function gt(t){return U.isIsolateType(t,V)}function Rt(t){l(gt(t))}function It(t){return Rt(t),t}function _t(t,e){return!!e&&!mt(t,e)}function mt(t,e){return!(!e||t.fieldName!==e)}class pt{static hasNoTests(t=pt.defaultRoot()){return!t||!F.has(t,gt)}static someIncompleteTests(t,e=pt.defaultRoot()){return!!e&&F.some(e,(e=>(Rt(e),St.isPending(e)&&t(e))),gt)}static someTests(t,e=pt.defaultRoot()){return!!e&&F.some(e,(e=>(Rt(e),t(e))),gt)}static everyTest(t,e=pt.defaultRoot()){return!!e&&F.every(e,(e=>(Rt(e),t(e))),gt)}static walkTests(t,e=pt.defaultRoot()){e&&F.walk(e,((e,n)=>{t(It(e),n)}),gt)}static hasRemainingTests(t){return pt.someIncompleteTests((e=>!t||mt(St.getData(e),t)))}static pluckTests(t,e=pt.defaultRoot()){e&&F.pluck(e,(e=>(Rt(e),t(e))),gt)}static resetField(t){pt.walkTests((e=>{mt(St.getData(e),t)&&St.reset(e)}),pt.defaultRoot())}static removeTestByFieldName(t,e=pt.defaultRoot()){pt.pluckTests((e=>mt(St.getData(e),t)),e)}}function Dt(){const t=L.useAvailableRoot(),e=H.getOptionalFields(t);if(d(e))return;const n=new Set;function s(e){const{fieldName:s}=St.getData(e);n.has(s)&&(St.omit(e),H.setOptionalField(t,s,(t=>Object.assign(Object.assign({},t),{applied:!0}))))}pt.walkTests((e=>{if(St.isPending(e))return;const{fieldName:r}=St.getData(e);n.has(r)?s(e):function(e){const{fieldName:r}=St.getData(e),i=H.getOptionalField(t,r);!0===f(i.rule)&&n.add(r);s(e)}(e)})),G.useEmit($.DONE_TEST_OMISSION_PASS)}function Ot(){const t=G.useBus();return e($.TEST_COMPLETED,(e=>{if(St.isCanceled(e))return;const{fieldName:n}=St.getData(e);!function(t){const[e]=st();t&&!pt.hasRemainingTests(t)&&r(e[t])&&N(e[t])}(n),pt.hasRemainingTests()||t.emit($.ALL_RUNNING_TESTS_FINISHED)})),e($.TEST_RUN_STARTED,(()=>{})),e($.DONE_TEST_OMISSION_PASS,(()=>{})),e($.ALL_RUNNING_TESTS_FINISHED,(()=>{pt.someTests(St.isAsyncTest)&&Dt(),function(){const[t]=nt();N(t)}()})),e($.RESET_FIELD,(t=>{pt.resetField(t)})),e($.SUITE_RUN_STARTED,(()=>{at()})),e($.SUITE_CALLBACK_RUN_FINISHED,(()=>{Dt()})),e($.REMOVE_FIELD,(t=>{pt.removeTestByFieldName(t)})),e($.RESET_SUITE,(()=>{at(),L.reset()})),t;function e(e,n){t.on(e,((...t)=>{it(),n(...t)}))}}var At;function Ct(t,e){const{groupName:n}=St.getData(t),{groupName:s,fieldName:r}=St.getData(e);return mt(St.getData(t),r)&&n===s&&t.key===e.key}pt.defaultRoot=L.useAvailableRoot,function(t){t.HOOK_CALLED_OUTSIDE="hook called outside of a running suite.",t.EXPECTED_VEST_TEST="Expected value to be an instance of IsolateTest",t.FIELD_NAME_REQUIRED="Field name must be passed",t.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION="Suite must be initialized with a function",t.PROMISIFY_REQUIRE_FUNCTION="Vest.Promisify must be called with a function",t.PARSER_EXPECT_RESULT_OBJECT="Vest parser: expected argument at position 0 to be Vest's result object.",t.WARN_MUST_BE_CALLED_FROM_TEST="Warn must be called from within the body of a test function",t.EACH_CALLBACK_MUST_BE_A_FUNCTION="Each must be called with a function",t.INVALID_PARAM_PASSED_TO_FUNCTION='Incompatible params passed to {fn_name} function. "{param}" must be of type {expected}',t.TESTS_CALLED_IN_DIFFERENT_ORDER='Vest Critical Error: Tests called in different order than previous run.\n    expected: {fieldName}\n    received: {prevName}\n    This can happen on one of two reasons:\n    1. You\'re using if/else statements to conditionally select tests. Instead, use "skipWhen".\n    2. You are iterating over a list of tests, and their order changed. Use "each" and a custom key prop so that Vest retains their state.',t.UNEXPECTED_TEST_REGISTRATION_ERROR="Unexpected error encountered during test registration.\n      Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.\n      Error: {error}.",t.UNEXPECTED_TEST_RUN_ERROR="Unexpected error encountered during test run. Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.",t.INCLUDE_SELF="Trying to call include.when on the same field."}(At||(At={}));const vt=T((function(t,e){return St.getData(t).groupName===e}));function ht(t){return function(t,e){return pt.someTests((n=>Pt(n,t,e)))}(Et.ERRORS,t)}function Pt(t,e,n){return!!St.hasFailures(t)&&(!_t(St.getData(t),n)&&!function(t,e){return S(t===Et.WARNINGS,St.warns(e))}(e,t))}function Lt(t){const[,e]=z();e(t)}function Ut(t){const[e]=z();return e===t}function Ft(t){return Ut(x.ONE)?ht():!!Ut(x.EAGER)&&ht(t.fieldName)}function Gt(t,e,n){return n?function(t,e,n){var s;return(null===(s=null==t?void 0:t[n])||void 0===s?void 0:s[e])||[]}(t,e,n):function(t,e){const n={},s=Nt(e);for(const r in t)g(t[r][s])&&(n[r]=t[r][e]||[]);return n}(t,e)}function yt(t){const e={getError:function(e){return kt(Et.ERRORS,t,e)},getErrors:function(e){return Wt(t,Et.ERRORS,e)},getErrorsByGroup:function(e,n){return bt(t,Et.ERRORS,e,n)},getWarning:function(e){return kt(Et.WARNINGS,t,e)},getWarnings:function(e){return Wt(t,Et.WARNINGS,e)},getWarningsByGroup:function(e,n){return bt(t,Et.WARNINGS,e,n)},hasErrors:function(e){return wt(t,ft.ERROR_COUNT,e)},hasErrorsByGroup:function(e,n){return Bt(t,ft.ERROR_COUNT,e,n)},hasWarnings:function(e){return wt(t,ft.WARN_COUNT,e)},hasWarningsByGroup:function(e,n){return Bt(t,ft.WARN_COUNT,e,n)},isPending:function(e){var n;return R(e?null===(n=t.tests[e])||void 0===n?void 0:n.pendingCount:t.pendingCount,0)},isValid:function(e){var n;return e?Boolean(null===(n=t.tests[e])||void 0===n?void 0:n.valid):t.valid},isValidByGroup:function(e,n){const s=t.groups[e];if(!s)return!1;if(n)return Mt(s,n);for(const t in s)if(!Mt(s,t))return!1;return!0}};return e}function Wt(t,e,n){return Gt(t.tests,e,n)}function bt(t,e,n,s){return Gt(t.groups[n],e,s)}function Mt(t,e){var n;return!!(null===(n=t[e])||void 0===n?void 0:n.valid)}function Bt(t,e,n,s){var r,i;const a=t.groups[n];if(!a)return!1;if(s)return g(null===(r=a[s])||void 0===r?void 0:r[e]);for(const t in a)if(g(null===(i=a[t])||void 0===i?void 0:i[e]))return!0;return!1}function wt(t,e,n){var s;const r=n?null===(s=t.tests[n])||void 0===s?void 0:s[e]:t[e]||0;return g(r)}function kt(t,e,n){var s;const r=e[t];return n?null===(s=r.find((t=>mt(t,n))))||void 0===s?void 0:s.message:r[0]}var jt,Kt,Vt;class Ht{constructor(){this.errorCount=0,this.warnCount=0,this.testCount=0,this.pendingCount=0}}class Xt extends Ht{constructor(){super(...arguments),this[jt]=[],this[Kt]=[],this.groups={},this.tests={},this.valid=!1}}jt=Et.ERRORS,Kt=Et.WARNINGS;class xt{constructor(t,e,n){this.fieldName=t,this.message=e,this.groupName=n}static fromTestObject(t){const{fieldName:e,message:n,groupName:s}=St.getData(t);return new xt(e,n,s)}}function qt(t){return!!Z(t)||!pt.hasNoTests()&&(!ht(t)&&(!function(t){return pt.someIncompleteTests((e=>!_t(St.getData(e),t)&&!Z(t)))}(t)&&function(t){return pt.everyTest((e=>zt(e,t)))}(t)))}function Yt(t,e){return!!Z(e)||!function(t,e,n){return pt.someTests((s=>!vt(s,e)&&Pt(s,t,n)))}(Et.ERRORS,t,e)&&(!function(t,e){return pt.someIncompleteTests((n=>!vt(n,t)&&(!_t(St.getData(n),e)&&!Z(e))))}(t,e)&&function(t,e){return pt.everyTest((n=>!!vt(n,t)||zt(n,e)))}(t,e))}function zt(t,e){return!!_t(St.getData(t),e)||(St.isOmitted(t)||St.isTested(t)||function(t){const e=L.useAvailableRoot(),{fieldName:n}=St.getData(t);return H.getOptionalField(e,n).type===X.AUTO&&St.awaitsResolution(t)}(t))}function Jt(){const t=new Xt;return pt.walkTests((e=>{t.tests=function(t,e){const n=St.getData(e).fieldName,s=Object.assign({},t);return s[n]=Zt(s[n],e),s[n].valid=!1!==s[n].valid&&qt(n),s}(t.tests,e),t.groups=function(t,e){const{groupName:n,fieldName:s}=St.getData(e);if(!n)return t;const r=Object.assign({},t);return r[n]=r[n]||{},r[n][s]=Zt(r[n][s],e),r[n][s].valid=!1!==r[n][s].valid&&Yt(n,s),r}(t.groups,e),t.errors=Qt(Et.ERRORS,t.errors,e),t.warnings=Qt(Et.WARNINGS,t.warnings,e)})),t.valid=qt(),function(t){for(const e in t.tests)t.errorCount+=t.tests[e].errorCount,t.warnCount+=t.tests[e].warnCount,t.testCount+=t.tests[e].testCount,t.pendingCount+=t.tests[e].pendingCount;return t}(t)}function Qt(t,e,n){if(St.isOmitted(n))return e;return(t===Et.WARNINGS?St.isWarning(n):St.isFailing(n))?e.concat(xt.fromTestObject(n)):e}function Zt(t,e){const{message:n}=St.getData(e),s=I(t?Object.assign({},t):null,$t);return St.isNonActionable(e)||(St.isPending(e)&&s.pendingCount++,St.isFailing(e)?r(Et.ERRORS):St.isWarning(e)&&r(Et.WARNINGS),s.testCount++),s;function r(t){const e=Nt(t);s[e]++,n&&(s[t]=(s[t]||[]).concat(n))}}function $t(){return e(new Ht,{errors:[],valid:!0,warnings:[]})}function te(){return t=()=>{const t=Jt(),n=et().suiteName;return Object.freeze(e(t,yt(t),{suiteName:n}))},(0,et().suiteResultCache)([rt()],t);var t}function ee(t,e){P.create(k,(()=>{q.run({omitted:ne()||f(t,f(te))},e)}))}function ne(){return function(){var t;return null!==(t=q.useX().omitted)&&void 0!==t&&t}()}function se(t,e){P.create(j,(()=>{q.run({skipped:re()||f(t,f(te))},e)}))}function re(){return function(){var t;return null!==(t=q.useX().skipped)&&void 0!==t&&t}()}function ie(t,e){return P.create(B,_,{focusMode:t,match:a(e).filter(i),matchAll:!0===e})}!function(t){t[t.ONLY=0]="ONLY",t[t.SKIP=1]="SKIP"}(Vt||(Vt={}));class ae{static isSkipFocused(t,e){return(null==t?void 0:t.data.focusMode)===Vt.SKIP&&(le(t,e)||!0===t.data.matchAll)}static isOnlyFocused(t,e){return(null==t?void 0:t.data.focusMode)===Vt.ONLY&&le(t,e)}static isIsolateFocused(t){return U.isIsolateType(t,B)}}function oe(t){return ie(Vt.ONLY,ce(t))}function ue(t){return ie(Vt.SKIP,ce(t))}function ce(t){return!1===t?[]:t}function le(t,e){var n,s;return m(null==t?void 0:t.data.match)&&(!e||(null===(s=null===(n=null==t?void 0:t.data.match)||void 0===n?void 0:n.includes(e))||void 0===s||s))}function Ee(t,e){return p(F.findClosest(t,(t=>!!ae.isIsolateFocused(t)&&ae.isOnlyFocused(t,e))))}function fe(t){const{fieldName:e}=St.getData(t);if(re())return!0;const n=Y(),s=function(t){return F.findClosest(t,(e=>{var n;if(!ae.isIsolateFocused(e))return!1;const{fieldName:s}=St.getData(t);return(null===(n=e.data.match)||void 0===n?void 0:n.includes(s))||e.data.matchAll}))}(t);if(ae.isSkipFocused(s))return!0;return!ae.isOnlyFocused(s)&&(!!Ee(t)&&!f(n[e],t))}function de(t,e=t){const n=St.getData(t);return Ft(n)?(s=t,St.skip(s),s):(r=n.fieldName,ne()||Z(r)?function(t){return St.omit(t),t}(t):fe(t)?function(t){return St.skip(t,re()),t}(e):t);var s,r}function Ne(t,e){const n=function(t,e){const n=function(t,e){if(y.usesKey(t))return It(W.handleIsolateNodeWithKey(t));if(W.dropNextNodesOnReorder(Te,t,e))return function(t,e){if(y.canReorder(t))return;D(O(At.TESTS_CALLED_IN_DIFFERENT_ORDER,{fieldName:St.getData(t).fieldName,prevName:gt(e)?St.getData(e).fieldName:void 0}))}(t,e),t;if(!gt(e))return t;if(St.isOmitted(e))return t;return e}(e,t);return de(e,n)}(e,t);return function(t,e,n){t===e&&gt(e)&&(r=e)!==(s=n)&&Ct(s,r)&&St.isPending(s)&&St.cancel(s);var s,r}(n,t,e),n}function Te(t,e){return gt(e)&&!Ct(e,t)}function Se(t,e){return gt(t)&&gt(e)?Ne(t,e):null}function ge(...t){const[e,n]=t.reverse();return P.create(w,(()=>q.run(Object.assign({},n&&{groupName:n}),e)))}function Re(t){l(i(t));return Y()[t]=!0,{when:function(e){l(e!==t,At.INCLUDE_SELF);Y()[t]=function(t){return i(e)?Ee(t,e):f(e,f(te))}}}}function Ie(t,e,n){const s=Object.assign(Object.assign({},{severity:dt.Error,status:ut.UNTESTED}),{fieldName:e.fieldName,testFn:e.testFn});e.groupName&&(s.groupName=e.groupName),e.message&&(s.message=e.message);return P.create(V,t,s,null!=n?n:null)}function _e(t){if(de(t),St.isUntested(t))return function(t){const e=G.useBus(),n=function(t){return q.run({currentTest:t},(()=>{let e;const{message:n,testFn:s}=St.getData(t);try{e=s()}catch(s){(function(t,e){return A(t)&&i(e)})(n,s)&&(St.getData(t).message=s),e=!1}return!1===e&&St.fail(t),e}))}(t);try{E(n)?(St.getData(t).asyncTest=n,function(t){const{asyncTest:e,message:n}=St.getData(t);if(!E(e))return;St.setPending(t);const s=G.useBus(),r=L.persist((()=>{me(s,t)})),a=L.persist((e=>{St.isCanceled(t)||(St.getData(t).message=i(e)?e:n,St.fail(t),r())}));e.then(r,a)}(t)):me(e,t)}catch(e){throw new Error(O(At.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t),error:e}))}}(t);St.isNonActionable(t)||D(O(At.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t)}))}function me(t,e){St.pass(e),t.emit($.TEST_COMPLETED,e)}function pe(t,...e){const[n,s,r]=v(e[1])?e:[void 0,...e];!function(t,e){const n="test";l(i(t),O(At.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:n,param:"fieldName",expected:"string"})),l(v(e),O(At.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:n,param:"callback",expected:"function"}))}(t,s);const a={fieldName:t,groupName:q.useX().groupName,message:n,testFn:s};return G.useEmit($.TEST_RUN_STARTED),Ie(_e,a,r)}const De=e(pe,{memo:function(t){return function(e,...n){const[s,r,i]=n.reverse();return function(t,e){const n=q.useX().testMemoCache,s=n.get(t);if(C(s))return n(t,e);const[,r]=s;if(St.isCanceled(r))return n.invalidate(t),n(t,e);return L.addNodeToHistory(r),r}([rt(),e,L.useCurrentCursor()].concat(s),(function(){return t(e,i,r)}))}}(pe)});function Oe(){return{group:ge,include:Re,omitWhen:ee,only:oe,optional:Q,skip:ue,skipWhen:se,test:De}}function Ae(){return Object.freeze(e({done:L.persist(Ce)},te()))}function Ce(...t){const[n,s]=t.reverse(),r=Ae();if(function(t,e,n){var s,r;return!!(!v(t)||h(n.testCount,0)||e&&h(null!==(r=null===(s=n.tests[e])||void 0===s?void 0:s.testCount)&&void 0!==r?r:0,0))}(n,s,r))return r;const i=()=>n(te());return pt.hasRemainingTests(s)?(function(t,n){const[,s]=st(),[,r]=nt();n?s((s=>e(s,{[n]:(s[n]||[]).concat(t)}))):r((e=>e.concat(t)))}(i,s),r):(i(),r)}function ve(...t){const[s,r]=t.reverse();!function(t){l(v(t),At.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION)}(s);const i=function({suiteName:t,VestReconciler:e}){const s={doneCallbacks:n.createTinyState((()=>[])),fieldCallbacks:n.createTinyState((()=>({}))),suiteId:u(),suiteName:t,suiteResultCache:tt};return L.createRef(e,s)}({suiteName:r,VestReconciler:Se});function a(...t){return q.run({suiteParams:t},(()=>{return G.useEmit($.SUITE_RUN_STARTED),e=function(t,...e){const n=G.useEmit();return()=>(t(...e),n($.SUITE_CALLBACK_RUN_FINISHED),Ae())}(s,...t),P.create(K,e,{optional:{}});var e})).output}return L.Run(i,(()=>{return Ot(),e(L.persist(a),Object.assign(Object.assign({dump:L.persist((()=>L.useHistoryRoot()[0])),get:L.persist(te),remove:G.usePrepareEmitter($.REMOVE_FIELD),reset:G.usePrepareEmitter($.RESET_SUITE),resetField:G.usePrepareEmitter($.RESET_FIELD),resume:L.persist(ot)},(t=L.persist(te),{getError:(...e)=>t().getError(...e),getErrors:(...e)=>t().getErrors(...e),getErrorsByGroup:(...e)=>t().getErrorsByGroup(...e),getWarning:(...e)=>t().getWarning(...e),getWarnings:(...e)=>t().getWarnings(...e),getWarningsByGroup:(...e)=>t().getWarningsByGroup(...e),hasErrors:(...e)=>t().hasErrors(...e),hasErrorsByGroup:(...e)=>t().hasErrorsByGroup(...e),hasWarnings:(...e)=>t().hasWarnings(...e),hasWarningsByGroup:(...e)=>t().hasWarningsByGroup(...e),isPending:(...e)=>t().isPending(...e),isValid:(...e)=>t().isValid(...e),isValidByGroup:(...e)=>t().isValidByGroup(...e)})),Oe()));var t}))}function he(t,e){l(v(e),At.EACH_CALLBACK_MUST_BE_A_FUNCTION),function(t){P.create(M,t,{allowReorder:!0})}((()=>{t.forEach(((t,n)=>{e(t,n)}))}))}function Pe(t){return e(((...n)=>{const s=ve(t),r=s(...n);return Object.freeze(e({dump:s.dump},r))}),Object.assign({},Oe()))}const Le=At.WARN_MUST_BE_CALLED_FROM_TEST;function Ue(){const t=(e=At.HOOK_CALLED_OUTSIDE,q.useX(e).currentTest);var e;l(t,Le),St.warn(t)}export{x as Modes,ve as create,he as each,ge as group,Re as include,Lt as mode,ee as omitWhen,oe as only,Q as optional,ue as skip,se as skipWhen,Pe as staticSuite,yt as suiteSelectors,De as test,Ue as warn};
