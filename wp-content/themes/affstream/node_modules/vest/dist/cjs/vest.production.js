"use strict";var t=require("n4s"),e=require("vest-utils"),n=require("vestjs-runtime"),s=require("context");const i="Each",r="Focused",a="Group",o="OmitWhen",u="SkipWhen",c="Suite",l="Test";class E{static setOptionalField(t,n,s){const i=t.data.optional,r=i[n];e.assign(i,{[n]:e.assign({},r,s(r))})}static getOptionalField(t,e){var n;return null!==(n=t.data.optional[e])&&void 0!==n?n:{}}static getOptionalFields(t){return t.data.optional}}var d,f;!function(t){t[t.CUSTOM_LOGIC=0]="CUSTOM_LOGIC",t[t.AUTO=1]="AUTO"}(d||(d={})),exports.Modes=void 0,(f=exports.Modes||(exports.Modes={})).EAGER="EAGER",f.ALL="ALL",f.ONE="ONE";const N=s.createCascade(((t,n)=>n?null:e.assign({inclusion:{},mode:e.tinyState.createTinyState(exports.Modes.EAGER),suiteParams:[],testMemoCache:g},t)));function T(){return N.useX().inclusion}function S(){return N.useX().mode()}const g=e.cache(10);function R(s){var i;const r=n.VestRuntime.useAvailableRoot(),a=N.useX().suiteParams,o=null!==(i=null==a?void 0:a[0])&&void 0!==i?i:{};if(e.isArray(s)||e.isStringValue(s))e.asArray(s).forEach((n=>{E.setOptionalField(r,n,(()=>({type:d.AUTO,applied:!!e.hasOwnProperty(o,n)&&t.enforce.isBlank().test(null==o?void 0:o[n]),rule:null})))}));else for(const e in s){const n=s[e];E.setOptionalField(r,e,(()=>({type:d.CUSTOM_LOGIC,rule:n,applied:t.enforce.isBlank().test(n)||!0===n})))}}function p(t){var e,s;if(!t)return!1;const i=n.VestRuntime.useAvailableRoot();return null!==(s=null===(e=E.getOptionalField(i,t))||void 0===e?void 0:e.applied)&&void 0!==s&&s}var I;!function(t){t.TEST_RUN_STARTED="test_run_started",t.TEST_COMPLETED="test_completed",t.ALL_RUNNING_TESTS_FINISHED="all_running_tests_finished",t.REMOVE_FIELD="remove_field",t.RESET_FIELD="reset_field",t.RESET_SUITE="reset_suite",t.SUITE_RUN_STARTED="suite_run_started",t.SUITE_CALLBACK_RUN_FINISHED="SUITE_CALLBACK_RUN_FINISHED",t.DONE_TEST_OMISSION_PASS="DONE_TEST_OMISSION_PASS"}(I||(I={}));const m=e.cache();function _(){return n.VestRuntime.useXAppData()}function O(){return _().doneCallbacks()}function D(){return _().fieldCallbacks()}function A(){return _().suiteId}function v(){_().suiteResultCache.invalidate([A()])}function C(){const[,,t]=O(),[,,e]=D();t(),e()}function h(t){n.VestRuntime.useLoadRootNode(t),v()}var F,P;!function(t){t.UNTESTED="UNTESTED",t.SKIPPED="SKIPPED",t.FAILED="FAILED",t.WARNING="WARNING",t.PASSING="PASSING",t.PENDING="PENDING",t.CANCELED="CANCELED",t.OMITTED="OMITTED"}(F||(F={})),function(t){t.RESET="RESET"}(P||(P={}));const L={initial:F.UNTESTED,states:{"*":{[F.OMITTED]:F.OMITTED,[P.RESET]:F.UNTESTED},[F.UNTESTED]:{[F.CANCELED]:F.CANCELED,[F.FAILED]:F.FAILED,[F.PASSING]:F.PASSING,[F.PENDING]:F.PENDING,[F.SKIPPED]:F.SKIPPED,[F.WARNING]:F.WARNING},[F.PENDING]:{[F.CANCELED]:F.CANCELED,[F.FAILED]:F.FAILED,[F.PASSING]:F.PASSING,[F.SKIPPED]:[F.SKIPPED,t=>!0===t],[F.WARNING]:F.WARNING},[F.SKIPPED]:{},[F.FAILED]:{},[F.WARNING]:{},[F.PASSING]:{},[F.CANCELED]:{},[F.OMITTED]:{}}};var U,y,G;function W(t){return t===U.ERRORS?y.ERROR_COUNT:y.WARN_COUNT}!function(t){t.WARNINGS="warnings",t.ERRORS="errors"}(U||(U={})),function(t){t.ERROR_COUNT="errorCount",t.WARN_COUNT="warnCount"}(y||(y={})),function(t){t.Error="error",t.Warning="warning"}(G||(G={}));const V=e.StateMachine(L);class b{static getData(t){return e.invariant(t.data),t.data}static warns(t){return b.getData(t).severity===G.Warning}static isPending(t){return b.statusEquals(t,F.PENDING)}static isOmitted(t){return b.statusEquals(t,F.OMITTED)}static isUntested(t){return b.statusEquals(t,F.UNTESTED)}static isFailing(t){return b.statusEquals(t,F.FAILED)}static isCanceled(t){return b.statusEquals(t,F.CANCELED)}static isSkipped(t){return b.statusEquals(t,F.SKIPPED)}static isPassing(t){return b.statusEquals(t,F.PASSING)}static isWarning(t){return b.statusEquals(t,F.WARNING)}static hasFailures(t){return b.isFailing(t)||b.isWarning(t)}static isNonActionable(t){return b.isSkipped(t)||b.isOmitted(t)||b.isCanceled(t)}static isTested(t){return b.hasFailures(t)||b.isPassing(t)}static awaitsResolution(t){return b.isSkipped(t)||b.isUntested(t)||b.isPending(t)}static isAsyncTest(t){return e.isPromise(b.getData(t).asyncTest)}static statusEquals(t,e){return b.getData(t).status===e}static setPending(t){b.setStatus(t,F.PENDING)}static fail(t){b.setStatus(t,b.warns(t)?F.WARNING:F.FAILED)}static pass(t){b.setStatus(t,F.PASSING)}static warn(t){b.setData(t,(t=>Object.assign(Object.assign({},t),{severity:G.Warning})))}static setData(t,n){t.data=e.optionalFunctionValue(n,b.getData(t))}static skip(t,e){b.setStatus(t,F.SKIPPED,e)}static cancel(t){b.setStatus(t,F.CANCELED)}static omit(t){b.setStatus(t,F.OMITTED)}static reset(t){b.setStatus(t,P.RESET)}static setStatus(t,e,n){b.setData(t,(t=>Object.assign(Object.assign({},t),{status:V.staticTransition(t.status,e,n)})))}}function B(t){return n.IsolateSelectors.isIsolateType(t,l)}function M(t){e.invariant(B(t))}function k(t){return M(t),t}function w(t,e){return!!e&&!x(t,e)}function x(t,e){return!(!e||t.fieldName!==e)}class j{static hasNoTests(t=j.defaultRoot()){return!t||!n.Walker.has(t,B)}static someIncompleteTests(t,e=j.defaultRoot()){return!!e&&n.Walker.some(e,(e=>(M(e),b.isPending(e)&&t(e))),B)}static someTests(t,e=j.defaultRoot()){return!!e&&n.Walker.some(e,(e=>(M(e),t(e))),B)}static everyTest(t,e=j.defaultRoot()){return!!e&&n.Walker.every(e,(e=>(M(e),t(e))),B)}static walkTests(t,e=j.defaultRoot()){e&&n.Walker.walk(e,((e,n)=>{t(k(e),n)}),B)}static hasRemainingTests(t){return j.someIncompleteTests((e=>!t||x(b.getData(e),t)))}static pluckTests(t,e=j.defaultRoot()){e&&n.Walker.pluck(e,(e=>(M(e),t(e))),B)}static resetField(t){j.walkTests((e=>{x(b.getData(e),t)&&b.reset(e)}),j.defaultRoot())}static removeTestByFieldName(t,e=j.defaultRoot()){j.pluckTests((e=>x(b.getData(e),t)),e)}}function K(){const t=n.VestRuntime.useAvailableRoot(),s=E.getOptionalFields(t);if(e.isEmpty(s))return;const i=new Set;function r(e){const{fieldName:n}=b.getData(e);i.has(n)&&(b.omit(e),E.setOptionalField(t,n,(t=>Object.assign(Object.assign({},t),{applied:!0}))))}j.walkTests((n=>{if(b.isPending(n))return;const{fieldName:s}=b.getData(n);i.has(s)?r(n):function(n){const{fieldName:s}=b.getData(n),a=E.getOptionalField(t,s);!0===e.optionalFunctionValue(a.rule)&&i.add(s);r(n)}(n)})),n.Bus.useEmit(I.DONE_TEST_OMISSION_PASS)}function q(){const t=n.Bus.useBus();return s(I.TEST_COMPLETED,(n=>{if(b.isCanceled(n))return;const{fieldName:s}=b.getData(n);!function(t){const[n]=D();t&&!j.hasRemainingTests(t)&&e.isArray(n[t])&&e.callEach(n[t])}(s),j.hasRemainingTests()||t.emit(I.ALL_RUNNING_TESTS_FINISHED)})),s(I.TEST_RUN_STARTED,(()=>{})),s(I.DONE_TEST_OMISSION_PASS,(()=>{})),s(I.ALL_RUNNING_TESTS_FINISHED,(()=>{j.someTests(b.isAsyncTest)&&K(),function(){const[t]=O();e.callEach(t)}()})),s(I.RESET_FIELD,(t=>{j.resetField(t)})),s(I.SUITE_RUN_STARTED,(()=>{C()})),s(I.SUITE_CALLBACK_RUN_FINISHED,(()=>{K()})),s(I.REMOVE_FIELD,(t=>{j.removeTestByFieldName(t)})),s(I.RESET_SUITE,(()=>{C(),n.VestRuntime.reset()})),t;function s(e,n){t.on(e,((...t)=>{v(),n(...t)}))}}var H;function X(t,e){const{groupName:n}=b.getData(t),{groupName:s,fieldName:i}=b.getData(e);return x(b.getData(t),i)&&n===s&&t.key===e.key}j.defaultRoot=n.VestRuntime.useAvailableRoot,function(t){t.HOOK_CALLED_OUTSIDE="hook called outside of a running suite.",t.EXPECTED_VEST_TEST="Expected value to be an instance of IsolateTest",t.FIELD_NAME_REQUIRED="Field name must be passed",t.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION="Suite must be initialized with a function",t.PROMISIFY_REQUIRE_FUNCTION="Vest.Promisify must be called with a function",t.PARSER_EXPECT_RESULT_OBJECT="Vest parser: expected argument at position 0 to be Vest's result object.",t.WARN_MUST_BE_CALLED_FROM_TEST="Warn must be called from within the body of a test function",t.EACH_CALLBACK_MUST_BE_A_FUNCTION="Each must be called with a function",t.INVALID_PARAM_PASSED_TO_FUNCTION='Incompatible params passed to {fn_name} function. "{param}" must be of type {expected}',t.TESTS_CALLED_IN_DIFFERENT_ORDER='Vest Critical Error: Tests called in different order than previous run.\n    expected: {fieldName}\n    received: {prevName}\n    This can happen on one of two reasons:\n    1. You\'re using if/else statements to conditionally select tests. Instead, use "skipWhen".\n    2. You are iterating over a list of tests, and their order changed. Use "each" and a custom key prop so that Vest retains their state.',t.UNEXPECTED_TEST_REGISTRATION_ERROR="Unexpected error encountered during test registration.\n      Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.\n      Error: {error}.",t.UNEXPECTED_TEST_RUN_ERROR="Unexpected error encountered during test run. Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.",t.INCLUDE_SELF="Trying to call include.when on the same field."}(H||(H={}));const Y=e.bindNot((function(t,e){return b.getData(t).groupName===e}));function z(t){return function(t,e){return j.someTests((n=>J(n,t,e)))}(U.ERRORS,t)}function J(t,n,s){return!!b.hasFailures(t)&&(!w(b.getData(t),s)&&!function(t,n){return e.either(t===U.WARNINGS,b.warns(n))}(n,t))}function Q(t){const[e]=S();return e===t}function Z(t){return Q(exports.Modes.ONE)?z():!!Q(exports.Modes.EAGER)&&z(t.fieldName)}function $(t,n,s){return s?function(t,e,n){var s;return(null===(s=null==t?void 0:t[n])||void 0===s?void 0:s[e])||[]}(t,n,s):function(t,n){const s={},i=W(n);for(const r in t)e.isPositive(t[r][i])&&(s[r]=t[r][n]||[]);return s}(t,n)}function tt(t){const n={getError:function(e){return at(U.ERRORS,t,e)},getErrors:function(e){return et(t,U.ERRORS,e)},getErrorsByGroup:function(e,n){return nt(t,U.ERRORS,e,n)},getWarning:function(e){return at(U.WARNINGS,t,e)},getWarnings:function(e){return et(t,U.WARNINGS,e)},getWarningsByGroup:function(e,n){return nt(t,U.WARNINGS,e,n)},hasErrors:function(e){return rt(t,y.ERROR_COUNT,e)},hasErrorsByGroup:function(e,n){return it(t,y.ERROR_COUNT,e,n)},hasWarnings:function(e){return rt(t,y.WARN_COUNT,e)},hasWarningsByGroup:function(e,n){return it(t,y.WARN_COUNT,e,n)},isPending:function(n){var s;return n?e.greaterThan(null===(s=t.tests[n])||void 0===s?void 0:s.pendingCount,0):e.greaterThan(t.pendingCount,0)},isValid:function(e){var n;return e?Boolean(null===(n=t.tests[e])||void 0===n?void 0:n.valid):t.valid},isValidByGroup:function(e,n){const s=t.groups[e];if(!s)return!1;if(n)return st(s,n);for(const t in s)if(!st(s,t))return!1;return!0}};return n}function et(t,e,n){return $(t.tests,e,n)}function nt(t,e,n,s){return $(t.groups[n],e,s)}function st(t,e){var n;return!!(null===(n=t[e])||void 0===n?void 0:n.valid)}function it(t,n,s,i){var r,a;const o=t.groups[s];if(!o)return!1;if(i)return e.isPositive(null===(r=o[i])||void 0===r?void 0:r[n]);for(const t in o)if(e.isPositive(null===(a=o[t])||void 0===a?void 0:a[n]))return!0;return!1}function rt(t,n,s){var i;const r=s?null===(i=t.tests[s])||void 0===i?void 0:i[n]:t[n]||0;return e.isPositive(r)}function at(t,e,n){var s;const i=e[t];return n?null===(s=i.find((t=>x(t,n))))||void 0===s?void 0:s.message:i[0]}var ot,ut,ct;class lt{constructor(){this.errorCount=0,this.warnCount=0,this.testCount=0,this.pendingCount=0}}class Et extends lt{constructor(){super(...arguments),this[ot]=[],this[ut]=[],this.groups={},this.tests={},this.valid=!1}}ot=U.ERRORS,ut=U.WARNINGS;class dt{constructor(t,e,n){this.fieldName=t,this.message=e,this.groupName=n}static fromTestObject(t){const{fieldName:e,message:n,groupName:s}=b.getData(t);return new dt(e,n,s)}}function ft(t){return!!p(t)||!j.hasNoTests()&&(!z(t)&&(!function(t){return j.someIncompleteTests((e=>!w(b.getData(e),t)&&!p(t)))}(t)&&function(t){return j.everyTest((e=>Tt(e,t)))}(t)))}function Nt(t,e){return!!p(e)||!function(t,e,n){return j.someTests((s=>!Y(s,e)&&J(s,t,n)))}(U.ERRORS,t,e)&&(!function(t,e){return j.someIncompleteTests((n=>!Y(n,t)&&(!w(b.getData(n),e)&&!p(e))))}(t,e)&&function(t,e){return j.everyTest((n=>!!Y(n,t)||Tt(n,e)))}(t,e))}function Tt(t,e){return!!w(b.getData(t),e)||(b.isOmitted(t)||b.isTested(t)||function(t){const e=n.VestRuntime.useAvailableRoot(),{fieldName:s}=b.getData(t);return E.getOptionalField(e,s).type===d.AUTO&&b.awaitsResolution(t)}(t))}function St(){const t=new Et;return j.walkTests((e=>{t.tests=function(t,e){const n=b.getData(e).fieldName,s=Object.assign({},t);return s[n]=Rt(s[n],e),s[n].valid=!1!==s[n].valid&&ft(n),s}(t.tests,e),t.groups=function(t,e){const{groupName:n,fieldName:s}=b.getData(e);if(!n)return t;const i=Object.assign({},t);return i[n]=i[n]||{},i[n][s]=Rt(i[n][s],e),i[n][s].valid=!1!==i[n][s].valid&&Nt(n,s),i}(t.groups,e),t.errors=gt(U.ERRORS,t.errors,e),t.warnings=gt(U.WARNINGS,t.warnings,e)})),t.valid=ft(),function(t){for(const e in t.tests)t.errorCount+=t.tests[e].errorCount,t.warnCount+=t.tests[e].warnCount,t.testCount+=t.tests[e].testCount,t.pendingCount+=t.tests[e].pendingCount;return t}(t)}function gt(t,e,n){if(b.isOmitted(n))return e;return(t===U.WARNINGS?b.isWarning(n):b.isFailing(n))?e.concat(dt.fromTestObject(n)):e}function Rt(t,n){const{message:s}=b.getData(n),i=e.defaultTo(t?Object.assign({},t):null,pt);return b.isNonActionable(n)||(b.isPending(n)&&i.pendingCount++,b.isFailing(n)?r(U.ERRORS):b.isWarning(n)&&r(U.WARNINGS),i.testCount++),i;function r(t){const e=W(t);i[e]++,s&&(i[t]=(i[t]||[]).concat(s))}}function pt(){return e.assign(new lt,{errors:[],valid:!0,warnings:[]})}function It(){return t=()=>{const t=St(),n=_().suiteName;return Object.freeze(e.assign(t,tt(t),{suiteName:n}))},(0,_().suiteResultCache)([A()],t);var t}function mt(t,s){n.Isolate.create(o,(()=>{N.run({omitted:_t()||e.optionalFunctionValue(t,e.optionalFunctionValue(It))},s)}))}function _t(){return function(){var t;return null!==(t=N.useX().omitted)&&void 0!==t&&t}()}function Ot(t,s){n.Isolate.create(u,(()=>{N.run({skipped:Dt()||e.optionalFunctionValue(t,e.optionalFunctionValue(It))},s)}))}function Dt(){return function(){var t;return null!==(t=N.useX().skipped)&&void 0!==t&&t}()}function At(t,s){return n.Isolate.create(r,e.noop,{focusMode:t,match:e.asArray(s).filter(e.isStringValue),matchAll:!0===s})}!function(t){t[t.ONLY=0]="ONLY",t[t.SKIP=1]="SKIP"}(ct||(ct={}));class vt{static isSkipFocused(t,e){return(null==t?void 0:t.data.focusMode)===ct.SKIP&&(Pt(t,e)||!0===t.data.matchAll)}static isOnlyFocused(t,e){return(null==t?void 0:t.data.focusMode)===ct.ONLY&&Pt(t,e)}static isIsolateFocused(t){return n.IsolateSelectors.isIsolateType(t,r)}}function Ct(t){return At(ct.ONLY,Ft(t))}function ht(t){return At(ct.SKIP,Ft(t))}function Ft(t){return!1===t?[]:t}function Pt(t,n){var s,i;return e.isNotEmpty(null==t?void 0:t.data.match)&&(!n||(null===(i=null===(s=null==t?void 0:t.data.match)||void 0===s?void 0:s.includes(n))||void 0===i||i))}function Lt(t,s){return e.isNotNullish(n.Walker.findClosest(t,(t=>!!vt.isIsolateFocused(t)&&vt.isOnlyFocused(t,s))))}function Ut(t){const{fieldName:s}=b.getData(t);if(Dt())return!0;const i=T(),r=function(t){return n.Walker.findClosest(t,(e=>{var n;if(!vt.isIsolateFocused(e))return!1;const{fieldName:s}=b.getData(t);return(null===(n=e.data.match)||void 0===n?void 0:n.includes(s))||e.data.matchAll}))}(t);if(vt.isSkipFocused(r))return!0;return!vt.isOnlyFocused(r)&&(!!Lt(t)&&!e.optionalFunctionValue(i[s],t))}function yt(t,e=t){const n=b.getData(t);return Z(n)?(s=t,b.skip(s),s):(i=n.fieldName,_t()||p(i)?function(t){return b.omit(t),t}(t):Ut(t)?function(t){return b.skip(t,Dt()),t}(e):t);var s,i}function Gt(t,s){const i=function(t,s){const i=function(t,s){if(n.IsolateInspector.usesKey(t))return k(n.Reconciler.handleIsolateNodeWithKey(t));if(n.Reconciler.dropNextNodesOnReorder(Wt,t,s))return function(t,s){if(n.IsolateInspector.canReorder(t))return;e.deferThrow(e.text(H.TESTS_CALLED_IN_DIFFERENT_ORDER,{fieldName:b.getData(t).fieldName,prevName:B(s)?b.getData(s).fieldName:void 0}))}(t,s),t;if(!B(s))return t;if(b.isOmitted(s))return t;return s}(s,t);return yt(s,i)}(s,t);return function(t,e,n){t===e&&B(e)&&(i=e)!==(s=n)&&X(s,i)&&b.isPending(s)&&b.cancel(s);var s,i}(i,t,s),i}function Wt(t,e){return B(e)&&!X(e,t)}function Vt(t,e){return B(t)&&B(e)?Gt(t,e):null}function bt(...t){const[e,s]=t.reverse();return n.Isolate.create(a,(()=>N.run(Object.assign({},s&&{groupName:s}),e)))}function Bt(t){e.invariant(e.isStringValue(t));return T()[t]=!0,{when:function(n){e.invariant(n!==t,H.INCLUDE_SELF);T()[t]=function(t){return e.isStringValue(n)?Lt(t,n):e.optionalFunctionValue(n,e.optionalFunctionValue(It))}}}}function Mt(t,e,s){const i=Object.assign(Object.assign({},{severity:G.Error,status:F.UNTESTED}),{fieldName:e.fieldName,testFn:e.testFn});e.groupName&&(i.groupName=e.groupName),e.message&&(i.message=e.message);return n.Isolate.create(l,t,i,null!=s?s:null)}function kt(t){if(yt(t),b.isUntested(t))return function(t){const s=n.Bus.useBus(),i=function(t){return N.run({currentTest:t},(()=>{let n;const{message:s,testFn:i}=b.getData(t);try{n=i()}catch(i){(function(t,n){return e.isUndefined(t)&&e.isStringValue(n)})(s,i)&&(b.getData(t).message=i),n=!1}return!1===n&&b.fail(t),n}))}(t);try{e.isPromise(i)?(b.getData(t).asyncTest=i,function(t){const{asyncTest:s,message:i}=b.getData(t);if(!e.isPromise(s))return;b.setPending(t);const r=n.Bus.useBus(),a=n.VestRuntime.persist((()=>{wt(r,t)})),o=n.VestRuntime.persist((n=>{b.isCanceled(t)||(b.getData(t).message=e.isStringValue(n)?n:i,b.fail(t),a())}));s.then(a,o)}(t)):wt(s,t)}catch(n){throw new Error(e.text(H.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t),error:n}))}}(t);b.isNonActionable(t)||e.deferThrow(e.text(H.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t)}))}function wt(t,e){b.pass(e),t.emit(I.TEST_COMPLETED,e)}function xt(t,...s){const[i,r,a]=e.isFunction(s[1])?s:[void 0,...s];!function(t,n){const s="test";e.invariant(e.isStringValue(t),e.text(H.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"fieldName",expected:"string"})),e.invariant(e.isFunction(n),e.text(H.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"callback",expected:"function"}))}(t,r);const o={fieldName:t,groupName:N.useX().groupName,message:i,testFn:r};return n.Bus.useEmit(I.TEST_RUN_STARTED),Mt(kt,o,a)}const jt=e.assign(xt,{memo:function(t){return function(s,...i){const[r,a,o]=i.reverse();return function(t,s){const i=N.useX().testMemoCache,r=i.get(t);if(e.isNull(r))return i(t,s);const[,a]=r;if(b.isCanceled(a))return i.invalidate(t),i(t,s);return n.VestRuntime.addNodeToHistory(a),a}([A(),s,n.VestRuntime.useCurrentCursor()].concat(r),(function(){return t(s,o,a)}))}}(xt)});function Kt(){return{group:bt,include:Bt,omitWhen:mt,only:Ct,optional:R,skip:ht,skipWhen:Ot,test:jt}}function qt(){return Object.freeze(e.assign({done:n.VestRuntime.persist(Ht)},It()))}function Ht(...t){const[n,s]=t.reverse(),i=qt();if(function(t,n,s){var i,r;return!!(!e.isFunction(t)||e.numberEquals(s.testCount,0)||n&&e.numberEquals(null!==(r=null===(i=s.tests[n])||void 0===i?void 0:i.testCount)&&void 0!==r?r:0,0))}(n,s,i))return i;const r=()=>n(It());return j.hasRemainingTests(s)?(function(t,n){const[,s]=D(),[,i]=O();n?s((s=>e.assign(s,{[n]:(s[n]||[]).concat(t)}))):i((e=>e.concat(t)))}(r,s),i):(r(),i)}function Xt(...t){const[s,i]=t.reverse();!function(t){e.invariant(e.isFunction(t),H.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION)}(s);const r=function({suiteName:t,VestReconciler:s}){const i={doneCallbacks:e.tinyState.createTinyState((()=>[])),fieldCallbacks:e.tinyState.createTinyState((()=>({}))),suiteId:e.seq(),suiteName:t,suiteResultCache:m};return n.VestRuntime.createRef(s,i)}({suiteName:i,VestReconciler:Vt});function a(...t){return N.run({suiteParams:t},(()=>{return n.Bus.useEmit(I.SUITE_RUN_STARTED),e=function(t,...e){const s=n.Bus.useEmit();return()=>(t(...e),s(I.SUITE_CALLBACK_RUN_FINISHED),qt())}(s,...t),n.Isolate.create(c,e,{optional:{}});var e})).output}return n.VestRuntime.Run(r,(()=>{return q(),e.assign(n.VestRuntime.persist(a),Object.assign(Object.assign({dump:n.VestRuntime.persist((()=>n.VestRuntime.useHistoryRoot()[0])),get:n.VestRuntime.persist(It),remove:n.Bus.usePrepareEmitter(I.REMOVE_FIELD),reset:n.Bus.usePrepareEmitter(I.RESET_SUITE),resetField:n.Bus.usePrepareEmitter(I.RESET_FIELD),resume:n.VestRuntime.persist(h)},(t=n.VestRuntime.persist(It),{getError:(...e)=>t().getError(...e),getErrors:(...e)=>t().getErrors(...e),getErrorsByGroup:(...e)=>t().getErrorsByGroup(...e),getWarning:(...e)=>t().getWarning(...e),getWarnings:(...e)=>t().getWarnings(...e),getWarningsByGroup:(...e)=>t().getWarningsByGroup(...e),hasErrors:(...e)=>t().hasErrors(...e),hasErrorsByGroup:(...e)=>t().hasErrorsByGroup(...e),hasWarnings:(...e)=>t().hasWarnings(...e),hasWarningsByGroup:(...e)=>t().hasWarningsByGroup(...e),isPending:(...e)=>t().isPending(...e),isValid:(...e)=>t().isValid(...e),isValidByGroup:(...e)=>t().isValidByGroup(...e)})),Kt()));var t}))}const Yt=H.WARN_MUST_BE_CALLED_FROM_TEST;Object.defineProperty(exports,"enforce",{enumerable:!0,get:function(){return t.enforce}}),exports.create=Xt,exports.each=function(t,s){e.invariant(e.isFunction(s),H.EACH_CALLBACK_MUST_BE_A_FUNCTION),function(t){n.Isolate.create(i,t,{allowReorder:!0})}((()=>{t.forEach(((t,e)=>{s(t,e)}))}))},exports.group=bt,exports.include=Bt,exports.mode=function(t){const[,e]=S();e(t)},exports.omitWhen=mt,exports.only=Ct,exports.optional=R,exports.skip=ht,exports.skipWhen=Ot,exports.staticSuite=function(t){return e.assign(((...n)=>{const s=Xt(t),i=s(...n);return Object.freeze(e.assign({dump:s.dump},i))}),Object.assign({},Kt()))},exports.suiteSelectors=tt,exports.test=jt,exports.warn=function(){const t=(n=H.HOOK_CALLED_OUTSIDE,N.useX(n).currentTest);var n;e.invariant(t,Yt),b.warn(t)};
