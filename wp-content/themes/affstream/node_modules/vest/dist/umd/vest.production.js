!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("n4s"),require("vest-utils"),require("vestjs-runtime"),require("context")):"function"==typeof define&&define.amd?define(["exports","n4s","vest-utils","vestjs-runtime","context"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).vest={},t.n4s,t["vest-utils"],t["vestjs-runtime"],t.context)}(this,(function(t,e,n,s,i){"use strict";const r="Each",a="Focused",o="Group",u="OmitWhen",c="SkipWhen",l="Suite",E="Test";class d{static setOptionalField(t,e,s){const i=t.data.optional,r=i[e];n.assign(i,{[e]:n.assign({},r,s(r))})}static getOptionalField(t,e){var n;return null!==(n=t.data.optional[e])&&void 0!==n?n:{}}static getOptionalFields(t){return t.data.optional}}var f,N;!function(t){t[t.CUSTOM_LOGIC=0]="CUSTOM_LOGIC",t[t.AUTO=1]="AUTO"}(f||(f={})),t.Modes=void 0,(N=t.Modes||(t.Modes={})).EAGER="EAGER",N.ALL="ALL",N.ONE="ONE";const T=i.createCascade(((e,s)=>s?null:n.assign({inclusion:{},mode:n.tinyState.createTinyState(t.Modes.EAGER),suiteParams:[],testMemoCache:R},e)));function g(){return T.useX().inclusion}function S(){return T.useX().mode()}const R=n.cache(10);function I(t){var i;const r=s.VestRuntime.useAvailableRoot(),a=T.useX().suiteParams,o=null!==(i=null==a?void 0:a[0])&&void 0!==i?i:{};if(n.isArray(t)||n.isStringValue(t))n.asArray(t).forEach((t=>{d.setOptionalField(r,t,(()=>({type:f.AUTO,applied:!!n.hasOwnProperty(o,t)&&e.enforce.isBlank().test(null==o?void 0:o[t]),rule:null})))}));else for(const n in t){const s=t[n];d.setOptionalField(r,n,(()=>({type:f.CUSTOM_LOGIC,rule:s,applied:e.enforce.isBlank().test(s)||!0===s})))}}function m(t){var e,n;if(!t)return!1;const i=s.VestRuntime.useAvailableRoot();return null!==(n=null===(e=d.getOptionalField(i,t))||void 0===e?void 0:e.applied)&&void 0!==n&&n}var p;!function(t){t.TEST_RUN_STARTED="test_run_started",t.TEST_COMPLETED="test_completed",t.ALL_RUNNING_TESTS_FINISHED="all_running_tests_finished",t.REMOVE_FIELD="remove_field",t.RESET_FIELD="reset_field",t.RESET_SUITE="reset_suite",t.SUITE_RUN_STARTED="suite_run_started",t.SUITE_CALLBACK_RUN_FINISHED="SUITE_CALLBACK_RUN_FINISHED",t.DONE_TEST_OMISSION_PASS="DONE_TEST_OMISSION_PASS"}(p||(p={}));const _=n.cache();function O(){return s.VestRuntime.useXAppData()}function D(){return O().doneCallbacks()}function A(){return O().fieldCallbacks()}function v(){return O().suiteId}function C(){O().suiteResultCache.invalidate([v()])}function h(){const[,,t]=D(),[,,e]=A();t(),e()}function F(t){s.VestRuntime.useLoadRootNode(t),C()}var P,L;!function(t){t.UNTESTED="UNTESTED",t.SKIPPED="SKIPPED",t.FAILED="FAILED",t.WARNING="WARNING",t.PASSING="PASSING",t.PENDING="PENDING",t.CANCELED="CANCELED",t.OMITTED="OMITTED"}(P||(P={})),function(t){t.RESET="RESET"}(L||(L={}));const U={initial:P.UNTESTED,states:{"*":{[P.OMITTED]:P.OMITTED,[L.RESET]:P.UNTESTED},[P.UNTESTED]:{[P.CANCELED]:P.CANCELED,[P.FAILED]:P.FAILED,[P.PASSING]:P.PASSING,[P.PENDING]:P.PENDING,[P.SKIPPED]:P.SKIPPED,[P.WARNING]:P.WARNING},[P.PENDING]:{[P.CANCELED]:P.CANCELED,[P.FAILED]:P.FAILED,[P.PASSING]:P.PASSING,[P.SKIPPED]:[P.SKIPPED,t=>!0===t],[P.WARNING]:P.WARNING},[P.SKIPPED]:{},[P.FAILED]:{},[P.WARNING]:{},[P.PASSING]:{},[P.CANCELED]:{},[P.OMITTED]:{}}};var y,G,W;function b(t){return t===y.ERRORS?G.ERROR_COUNT:G.WARN_COUNT}!function(t){t.WARNINGS="warnings",t.ERRORS="errors"}(y||(y={})),function(t){t.ERROR_COUNT="errorCount",t.WARN_COUNT="warnCount"}(G||(G={})),function(t){t.Error="error",t.Warning="warning"}(W||(W={}));const V=n.StateMachine(U);class B{static getData(t){return n.invariant(t.data),t.data}static warns(t){return B.getData(t).severity===W.Warning}static isPending(t){return B.statusEquals(t,P.PENDING)}static isOmitted(t){return B.statusEquals(t,P.OMITTED)}static isUntested(t){return B.statusEquals(t,P.UNTESTED)}static isFailing(t){return B.statusEquals(t,P.FAILED)}static isCanceled(t){return B.statusEquals(t,P.CANCELED)}static isSkipped(t){return B.statusEquals(t,P.SKIPPED)}static isPassing(t){return B.statusEquals(t,P.PASSING)}static isWarning(t){return B.statusEquals(t,P.WARNING)}static hasFailures(t){return B.isFailing(t)||B.isWarning(t)}static isNonActionable(t){return B.isSkipped(t)||B.isOmitted(t)||B.isCanceled(t)}static isTested(t){return B.hasFailures(t)||B.isPassing(t)}static awaitsResolution(t){return B.isSkipped(t)||B.isUntested(t)||B.isPending(t)}static isAsyncTest(t){return n.isPromise(B.getData(t).asyncTest)}static statusEquals(t,e){return B.getData(t).status===e}static setPending(t){B.setStatus(t,P.PENDING)}static fail(t){B.setStatus(t,B.warns(t)?P.WARNING:P.FAILED)}static pass(t){B.setStatus(t,P.PASSING)}static warn(t){B.setData(t,(t=>Object.assign(Object.assign({},t),{severity:W.Warning})))}static setData(t,e){t.data=n.optionalFunctionValue(e,B.getData(t))}static skip(t,e){B.setStatus(t,P.SKIPPED,e)}static cancel(t){B.setStatus(t,P.CANCELED)}static omit(t){B.setStatus(t,P.OMITTED)}static reset(t){B.setStatus(t,L.RESET)}static setStatus(t,e,n){B.setData(t,(t=>Object.assign(Object.assign({},t),{status:V.staticTransition(t.status,e,n)})))}}function M(t){return s.IsolateSelectors.isIsolateType(t,E)}function k(t){n.invariant(M(t))}function w(t){return k(t),t}function j(t,e){return!!e&&!K(t,e)}function K(t,e){return!(!e||t.fieldName!==e)}class x{static hasNoTests(t=x.defaultRoot()){return!t||!s.Walker.has(t,M)}static someIncompleteTests(t,e=x.defaultRoot()){return!!e&&s.Walker.some(e,(e=>(k(e),B.isPending(e)&&t(e))),M)}static someTests(t,e=x.defaultRoot()){return!!e&&s.Walker.some(e,(e=>(k(e),t(e))),M)}static everyTest(t,e=x.defaultRoot()){return!!e&&s.Walker.every(e,(e=>(k(e),t(e))),M)}static walkTests(t,e=x.defaultRoot()){e&&s.Walker.walk(e,((e,n)=>{t(w(e),n)}),M)}static hasRemainingTests(t){return x.someIncompleteTests((e=>!t||K(B.getData(e),t)))}static pluckTests(t,e=x.defaultRoot()){e&&s.Walker.pluck(e,(e=>(k(e),t(e))),M)}static resetField(t){x.walkTests((e=>{K(B.getData(e),t)&&B.reset(e)}),x.defaultRoot())}static removeTestByFieldName(t,e=x.defaultRoot()){x.pluckTests((e=>K(B.getData(e),t)),e)}}function q(){const t=s.VestRuntime.useAvailableRoot(),e=d.getOptionalFields(t);if(n.isEmpty(e))return;const i=new Set;function r(e){const{fieldName:n}=B.getData(e);i.has(n)&&(B.omit(e),d.setOptionalField(t,n,(t=>Object.assign(Object.assign({},t),{applied:!0}))))}x.walkTests((e=>{if(B.isPending(e))return;const{fieldName:s}=B.getData(e);i.has(s)?r(e):function(e){const{fieldName:s}=B.getData(e),a=d.getOptionalField(t,s);!0===n.optionalFunctionValue(a.rule)&&i.add(s);r(e)}(e)})),s.Bus.useEmit(p.DONE_TEST_OMISSION_PASS)}function H(){const t=s.Bus.useBus();return e(p.TEST_COMPLETED,(e=>{if(B.isCanceled(e))return;const{fieldName:s}=B.getData(e);!function(t){const[e]=A();t&&!x.hasRemainingTests(t)&&n.isArray(e[t])&&n.callEach(e[t])}(s),x.hasRemainingTests()||t.emit(p.ALL_RUNNING_TESTS_FINISHED)})),e(p.TEST_RUN_STARTED,(()=>{})),e(p.DONE_TEST_OMISSION_PASS,(()=>{})),e(p.ALL_RUNNING_TESTS_FINISHED,(()=>{x.someTests(B.isAsyncTest)&&q(),function(){const[t]=D();n.callEach(t)}()})),e(p.RESET_FIELD,(t=>{x.resetField(t)})),e(p.SUITE_RUN_STARTED,(()=>{h()})),e(p.SUITE_CALLBACK_RUN_FINISHED,(()=>{q()})),e(p.REMOVE_FIELD,(t=>{x.removeTestByFieldName(t)})),e(p.RESET_SUITE,(()=>{h(),s.VestRuntime.reset()})),t;function e(e,n){t.on(e,((...t)=>{C(),n(...t)}))}}var X;function Y(t,e){const{groupName:n}=B.getData(t),{groupName:s,fieldName:i}=B.getData(e);return K(B.getData(t),i)&&n===s&&t.key===e.key}x.defaultRoot=s.VestRuntime.useAvailableRoot,function(t){t.HOOK_CALLED_OUTSIDE="hook called outside of a running suite.",t.EXPECTED_VEST_TEST="Expected value to be an instance of IsolateTest",t.FIELD_NAME_REQUIRED="Field name must be passed",t.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION="Suite must be initialized with a function",t.PROMISIFY_REQUIRE_FUNCTION="Vest.Promisify must be called with a function",t.PARSER_EXPECT_RESULT_OBJECT="Vest parser: expected argument at position 0 to be Vest's result object.",t.WARN_MUST_BE_CALLED_FROM_TEST="Warn must be called from within the body of a test function",t.EACH_CALLBACK_MUST_BE_A_FUNCTION="Each must be called with a function",t.INVALID_PARAM_PASSED_TO_FUNCTION='Incompatible params passed to {fn_name} function. "{param}" must be of type {expected}',t.TESTS_CALLED_IN_DIFFERENT_ORDER='Vest Critical Error: Tests called in different order than previous run.\n    expected: {fieldName}\n    received: {prevName}\n    This can happen on one of two reasons:\n    1. You\'re using if/else statements to conditionally select tests. Instead, use "skipWhen".\n    2. You are iterating over a list of tests, and their order changed. Use "each" and a custom key prop so that Vest retains their state.',t.UNEXPECTED_TEST_REGISTRATION_ERROR="Unexpected error encountered during test registration.\n      Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.\n      Error: {error}.",t.UNEXPECTED_TEST_RUN_ERROR="Unexpected error encountered during test run. Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.",t.INCLUDE_SELF="Trying to call include.when on the same field."}(X||(X={}));const z=n.bindNot((function(t,e){return B.getData(t).groupName===e}));function J(t){return function(t,e){return x.someTests((n=>Q(n,t,e)))}(y.ERRORS,t)}function Q(t,e,s){return!!B.hasFailures(t)&&(!j(B.getData(t),s)&&!function(t,e){return n.either(t===y.WARNINGS,B.warns(e))}(e,t))}function Z(t){const[e]=S();return e===t}function $(e){return Z(t.Modes.ONE)?J():!!Z(t.Modes.EAGER)&&J(e.fieldName)}function tt(t,e,s){return s?function(t,e,n){var s;return(null===(s=null==t?void 0:t[n])||void 0===s?void 0:s[e])||[]}(t,e,s):function(t,e){const s={},i=b(e);for(const r in t)n.isPositive(t[r][i])&&(s[r]=t[r][e]||[]);return s}(t,e)}function et(t){const e={getError:function(e){return ot(y.ERRORS,t,e)},getErrors:function(e){return nt(t,y.ERRORS,e)},getErrorsByGroup:function(e,n){return st(t,y.ERRORS,e,n)},getWarning:function(e){return ot(y.WARNINGS,t,e)},getWarnings:function(e){return nt(t,y.WARNINGS,e)},getWarningsByGroup:function(e,n){return st(t,y.WARNINGS,e,n)},hasErrors:function(e){return at(t,G.ERROR_COUNT,e)},hasErrorsByGroup:function(e,n){return rt(t,G.ERROR_COUNT,e,n)},hasWarnings:function(e){return at(t,G.WARN_COUNT,e)},hasWarningsByGroup:function(e,n){return rt(t,G.WARN_COUNT,e,n)},isPending:function(e){var s;return e?n.greaterThan(null===(s=t.tests[e])||void 0===s?void 0:s.pendingCount,0):n.greaterThan(t.pendingCount,0)},isValid:function(e){var n;return e?Boolean(null===(n=t.tests[e])||void 0===n?void 0:n.valid):t.valid},isValidByGroup:function(e,n){const s=t.groups[e];if(!s)return!1;if(n)return it(s,n);for(const t in s)if(!it(s,t))return!1;return!0}};return e}function nt(t,e,n){return tt(t.tests,e,n)}function st(t,e,n,s){return tt(t.groups[n],e,s)}function it(t,e){var n;return!!(null===(n=t[e])||void 0===n?void 0:n.valid)}function rt(t,e,s,i){var r,a;const o=t.groups[s];if(!o)return!1;if(i)return n.isPositive(null===(r=o[i])||void 0===r?void 0:r[e]);for(const t in o)if(n.isPositive(null===(a=o[t])||void 0===a?void 0:a[e]))return!0;return!1}function at(t,e,s){var i;const r=s?null===(i=t.tests[s])||void 0===i?void 0:i[e]:t[e]||0;return n.isPositive(r)}function ot(t,e,n){var s;const i=e[t];return n?null===(s=i.find((t=>K(t,n))))||void 0===s?void 0:s.message:i[0]}var ut,ct,lt;class Et{constructor(){this.errorCount=0,this.warnCount=0,this.testCount=0,this.pendingCount=0}}class dt extends Et{constructor(){super(...arguments),this[ut]=[],this[ct]=[],this.groups={},this.tests={},this.valid=!1}}ut=y.ERRORS,ct=y.WARNINGS;class ft{constructor(t,e,n){this.fieldName=t,this.message=e,this.groupName=n}static fromTestObject(t){const{fieldName:e,message:n,groupName:s}=B.getData(t);return new ft(e,n,s)}}function Nt(t){return!!m(t)||!x.hasNoTests()&&(!J(t)&&(!function(t){return x.someIncompleteTests((e=>!j(B.getData(e),t)&&!m(t)))}(t)&&function(t){return x.everyTest((e=>gt(e,t)))}(t)))}function Tt(t,e){return!!m(e)||!function(t,e,n){return x.someTests((s=>!z(s,e)&&Q(s,t,n)))}(y.ERRORS,t,e)&&(!function(t,e){return x.someIncompleteTests((n=>!z(n,t)&&(!j(B.getData(n),e)&&!m(e))))}(t,e)&&function(t,e){return x.everyTest((n=>!!z(n,t)||gt(n,e)))}(t,e))}function gt(t,e){return!!j(B.getData(t),e)||(B.isOmitted(t)||B.isTested(t)||function(t){const e=s.VestRuntime.useAvailableRoot(),{fieldName:n}=B.getData(t);return d.getOptionalField(e,n).type===f.AUTO&&B.awaitsResolution(t)}(t))}function St(){const t=new dt;return x.walkTests((e=>{t.tests=function(t,e){const n=B.getData(e).fieldName,s=Object.assign({},t);return s[n]=It(s[n],e),s[n].valid=!1!==s[n].valid&&Nt(n),s}(t.tests,e),t.groups=function(t,e){const{groupName:n,fieldName:s}=B.getData(e);if(!n)return t;const i=Object.assign({},t);return i[n]=i[n]||{},i[n][s]=It(i[n][s],e),i[n][s].valid=!1!==i[n][s].valid&&Tt(n,s),i}(t.groups,e),t.errors=Rt(y.ERRORS,t.errors,e),t.warnings=Rt(y.WARNINGS,t.warnings,e)})),t.valid=Nt(),function(t){for(const e in t.tests)t.errorCount+=t.tests[e].errorCount,t.warnCount+=t.tests[e].warnCount,t.testCount+=t.tests[e].testCount,t.pendingCount+=t.tests[e].pendingCount;return t}(t)}function Rt(t,e,n){if(B.isOmitted(n))return e;return(t===y.WARNINGS?B.isWarning(n):B.isFailing(n))?e.concat(ft.fromTestObject(n)):e}function It(t,e){const{message:s}=B.getData(e),i=n.defaultTo(t?Object.assign({},t):null,mt);return B.isNonActionable(e)||(B.isPending(e)&&i.pendingCount++,B.isFailing(e)?r(y.ERRORS):B.isWarning(e)&&r(y.WARNINGS),i.testCount++),i;function r(t){const e=b(t);i[e]++,s&&(i[t]=(i[t]||[]).concat(s))}}function mt(){return n.assign(new Et,{errors:[],valid:!0,warnings:[]})}function pt(){return t=()=>{const t=St(),e=O().suiteName;return Object.freeze(n.assign(t,et(t),{suiteName:e}))},(0,O().suiteResultCache)([v()],t);var t}function _t(t,e){s.Isolate.create(u,(()=>{T.run({omitted:Ot()||n.optionalFunctionValue(t,n.optionalFunctionValue(pt))},e)}))}function Ot(){return function(){var t;return null!==(t=T.useX().omitted)&&void 0!==t&&t}()}function Dt(t,e){s.Isolate.create(c,(()=>{T.run({skipped:At()||n.optionalFunctionValue(t,n.optionalFunctionValue(pt))},e)}))}function At(){return function(){var t;return null!==(t=T.useX().skipped)&&void 0!==t&&t}()}function vt(t,e){return s.Isolate.create(a,n.noop,{focusMode:t,match:n.asArray(e).filter(n.isStringValue),matchAll:!0===e})}!function(t){t[t.ONLY=0]="ONLY",t[t.SKIP=1]="SKIP"}(lt||(lt={}));class Ct{static isSkipFocused(t,e){return(null==t?void 0:t.data.focusMode)===lt.SKIP&&(Lt(t,e)||!0===t.data.matchAll)}static isOnlyFocused(t,e){return(null==t?void 0:t.data.focusMode)===lt.ONLY&&Lt(t,e)}static isIsolateFocused(t){return s.IsolateSelectors.isIsolateType(t,a)}}function ht(t){return vt(lt.ONLY,Pt(t))}function Ft(t){return vt(lt.SKIP,Pt(t))}function Pt(t){return!1===t?[]:t}function Lt(t,e){var s,i;return n.isNotEmpty(null==t?void 0:t.data.match)&&(!e||(null===(i=null===(s=null==t?void 0:t.data.match)||void 0===s?void 0:s.includes(e))||void 0===i||i))}function Ut(t,e){return n.isNotNullish(s.Walker.findClosest(t,(t=>!!Ct.isIsolateFocused(t)&&Ct.isOnlyFocused(t,e))))}function yt(t){const{fieldName:e}=B.getData(t);if(At())return!0;const i=g(),r=function(t){return s.Walker.findClosest(t,(e=>{var n;if(!Ct.isIsolateFocused(e))return!1;const{fieldName:s}=B.getData(t);return(null===(n=e.data.match)||void 0===n?void 0:n.includes(s))||e.data.matchAll}))}(t);if(Ct.isSkipFocused(r))return!0;return!Ct.isOnlyFocused(r)&&(!!Ut(t)&&!n.optionalFunctionValue(i[e],t))}function Gt(t,e=t){const n=B.getData(t);return $(n)?(s=t,B.skip(s),s):(i=n.fieldName,Ot()||m(i)?function(t){return B.omit(t),t}(t):yt(t)?function(t){return B.skip(t,At()),t}(e):t);var s,i}function Wt(t,e){const i=function(t,e){const i=function(t,e){if(s.IsolateInspector.usesKey(t))return w(s.Reconciler.handleIsolateNodeWithKey(t));if(s.Reconciler.dropNextNodesOnReorder(bt,t,e))return function(t,e){if(s.IsolateInspector.canReorder(t))return;n.deferThrow(n.text(X.TESTS_CALLED_IN_DIFFERENT_ORDER,{fieldName:B.getData(t).fieldName,prevName:M(e)?B.getData(e).fieldName:void 0}))}(t,e),t;if(!M(e))return t;if(B.isOmitted(e))return t;return e}(e,t);return Gt(e,i)}(e,t);return function(t,e,n){t===e&&M(e)&&(i=e)!==(s=n)&&Y(s,i)&&B.isPending(s)&&B.cancel(s);var s,i}(i,t,e),i}function bt(t,e){return M(e)&&!Y(e,t)}function Vt(t,e){return M(t)&&M(e)?Wt(t,e):null}function Bt(...t){const[e,n]=t.reverse();return s.Isolate.create(o,(()=>T.run(Object.assign({},n&&{groupName:n}),e)))}function Mt(t){n.invariant(n.isStringValue(t));return g()[t]=!0,{when:function(e){n.invariant(e!==t,X.INCLUDE_SELF);g()[t]=function(t){return n.isStringValue(e)?Ut(t,e):n.optionalFunctionValue(e,n.optionalFunctionValue(pt))}}}}function kt(t,e,n){const i=Object.assign(Object.assign({},{severity:W.Error,status:P.UNTESTED}),{fieldName:e.fieldName,testFn:e.testFn});e.groupName&&(i.groupName=e.groupName),e.message&&(i.message=e.message);return s.Isolate.create(E,t,i,null!=n?n:null)}function wt(t){if(Gt(t),B.isUntested(t))return function(t){const e=s.Bus.useBus(),i=function(t){return T.run({currentTest:t},(()=>{let e;const{message:s,testFn:i}=B.getData(t);try{e=i()}catch(i){(function(t,e){return n.isUndefined(t)&&n.isStringValue(e)})(s,i)&&(B.getData(t).message=i),e=!1}return!1===e&&B.fail(t),e}))}(t);try{n.isPromise(i)?(B.getData(t).asyncTest=i,function(t){const{asyncTest:e,message:i}=B.getData(t);if(!n.isPromise(e))return;B.setPending(t);const r=s.Bus.useBus(),a=s.VestRuntime.persist((()=>{jt(r,t)})),o=s.VestRuntime.persist((e=>{B.isCanceled(t)||(B.getData(t).message=n.isStringValue(e)?e:i,B.fail(t),a())}));e.then(a,o)}(t)):jt(e,t)}catch(e){throw new Error(n.text(X.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t),error:e}))}}(t);B.isNonActionable(t)||n.deferThrow(n.text(X.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t)}))}function jt(t,e){B.pass(e),t.emit(p.TEST_COMPLETED,e)}function Kt(t,...e){const[i,r,a]=n.isFunction(e[1])?e:[void 0,...e];!function(t,e){const s="test";n.invariant(n.isStringValue(t),n.text(X.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"fieldName",expected:"string"})),n.invariant(n.isFunction(e),n.text(X.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"callback",expected:"function"}))}(t,r);const o={fieldName:t,groupName:T.useX().groupName,message:i,testFn:r};return s.Bus.useEmit(p.TEST_RUN_STARTED),kt(wt,o,a)}const xt=n.assign(Kt,{memo:function(t){return function(e,...i){const[r,a,o]=i.reverse();return function(t,e){const i=T.useX().testMemoCache,r=i.get(t);if(n.isNull(r))return i(t,e);const[,a]=r;if(B.isCanceled(a))return i.invalidate(t),i(t,e);return s.VestRuntime.addNodeToHistory(a),a}([v(),e,s.VestRuntime.useCurrentCursor()].concat(r),(function(){return t(e,o,a)}))}}(Kt)});function qt(){return{group:Bt,include:Mt,omitWhen:_t,only:ht,optional:I,skip:Ft,skipWhen:Dt,test:xt}}function Ht(){return Object.freeze(n.assign({done:s.VestRuntime.persist(Xt)},pt()))}function Xt(...t){const[e,s]=t.reverse(),i=Ht();if(function(t,e,s){var i,r;return!!(!n.isFunction(t)||n.numberEquals(s.testCount,0)||e&&n.numberEquals(null!==(r=null===(i=s.tests[e])||void 0===i?void 0:i.testCount)&&void 0!==r?r:0,0))}(e,s,i))return i;const r=()=>e(pt());return x.hasRemainingTests(s)?(function(t,e){const[,s]=A(),[,i]=D();e?s((s=>n.assign(s,{[e]:(s[e]||[]).concat(t)}))):i((e=>e.concat(t)))}(r,s),i):(r(),i)}function Yt(...t){const[e,i]=t.reverse();!function(t){n.invariant(n.isFunction(t),X.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION)}(e);const r=function({suiteName:t,VestReconciler:e}){const i={doneCallbacks:n.tinyState.createTinyState((()=>[])),fieldCallbacks:n.tinyState.createTinyState((()=>({}))),suiteId:n.seq(),suiteName:t,suiteResultCache:_};return s.VestRuntime.createRef(e,i)}({suiteName:i,VestReconciler:Vt});function a(...t){return T.run({suiteParams:t},(()=>{return s.Bus.useEmit(p.SUITE_RUN_STARTED),n=function(t,...e){const n=s.Bus.useEmit();return()=>(t(...e),n(p.SUITE_CALLBACK_RUN_FINISHED),Ht())}(e,...t),s.Isolate.create(l,n,{optional:{}});var n})).output}return s.VestRuntime.Run(r,(()=>{return H(),n.assign(s.VestRuntime.persist(a),Object.assign(Object.assign({dump:s.VestRuntime.persist((()=>s.VestRuntime.useHistoryRoot()[0])),get:s.VestRuntime.persist(pt),remove:s.Bus.usePrepareEmitter(p.REMOVE_FIELD),reset:s.Bus.usePrepareEmitter(p.RESET_SUITE),resetField:s.Bus.usePrepareEmitter(p.RESET_FIELD),resume:s.VestRuntime.persist(F)},(t=s.VestRuntime.persist(pt),{getError:(...e)=>t().getError(...e),getErrors:(...e)=>t().getErrors(...e),getErrorsByGroup:(...e)=>t().getErrorsByGroup(...e),getWarning:(...e)=>t().getWarning(...e),getWarnings:(...e)=>t().getWarnings(...e),getWarningsByGroup:(...e)=>t().getWarningsByGroup(...e),hasErrors:(...e)=>t().hasErrors(...e),hasErrorsByGroup:(...e)=>t().hasErrorsByGroup(...e),hasWarnings:(...e)=>t().hasWarnings(...e),hasWarningsByGroup:(...e)=>t().hasWarningsByGroup(...e),isPending:(...e)=>t().isPending(...e),isValid:(...e)=>t().isValid(...e),isValidByGroup:(...e)=>t().isValidByGroup(...e)})),qt()));var t}))}const zt=X.WARN_MUST_BE_CALLED_FROM_TEST;Object.defineProperty(t,"enforce",{enumerable:!0,get:function(){return e.enforce}}),t.create=Yt,t.each=function(t,e){n.invariant(n.isFunction(e),X.EACH_CALLBACK_MUST_BE_A_FUNCTION),function(t){s.Isolate.create(r,t,{allowReorder:!0})}((()=>{t.forEach(((t,n)=>{e(t,n)}))}))},t.group=Bt,t.include=Mt,t.mode=function(t){const[,e]=S();e(t)},t.omitWhen=_t,t.only=ht,t.optional=I,t.skip=Ft,t.skipWhen=Dt,t.staticSuite=function(t){return n.assign(((...e)=>{const s=Yt(t),i=s(...e);return Object.freeze(n.assign({dump:s.dump},i))}),Object.assign({},qt()))},t.suiteSelectors=et,t.test=xt,t.warn=function(){const t=(e=X.HOOK_CALLED_OUTSIDE,T.useX(e).currentTest);var e;n.invariant(t,zt),B.warn(t)}}));
