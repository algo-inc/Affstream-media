<?php
/*
Template Name: Media University
*/
?>
<?php get_header( 'media' );
$page_id = get_the_ID();
$title   = get_the_title();
$content = get_post( $page_id );
?>
<div class="posts-section university" style="">
    <div class="title-container">
        <h2><?= $title ?></h2>
    </div>
    <div class="category-navigation">
	    <?php
	    $category_slug   = $_GET['category'] ?? '';
	    $category_id = 0;
	    $categories = get_terms( array(
		    'taxonomy'   => 'university-category',
		    'hide_empty' => false
	    ) );
	    if ( $categories ) {
		    foreach ( $categories as $cat ) {
			    $category_link = get_term_link( $cat );
			    $active_class = ($category_slug == $cat->slug) ? 'active' : '';
			    ?>
                <a href="#"  class="category-link <?php echo $active_class; ?>" data-category-id="<?= $cat->term_id ?>" data-category-slug="<?= $cat->slug ?>"><?= $cat->name ?></a>
			    <?php
		    }
	    }
	    ?>
        <a href="#" class=" glossary-link" data-category-slug="glossary">GLOSSARY</a>
    </div>

    <div class="category-posts">
		<?php
		if ( $category_slug ) {
			renderPostsByCategory();
		} else {
			the_content();
		}
		?>
		<?php
		if ( $content->post_excerpt ):?>
            <div class="description-container">
                <div class="description">
                    <div class="decoration-variant-university">
                        <svg width="164" height="164" viewBox="0 0 164 164" fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M55.5084 130.407L59.0244 124.62C59.7448 123.434 59.5173 122.234 58.274 121.479C57.0371 120.728 55.8673 121.079 55.147 122.264L51.6309 128.052L49.6954 126.876L53.3283 120.896C54.5665 118.858 56.9175 118.382 59.2825 119.819C61.6538 121.26 62.315 123.566 61.0768 125.604L57.4439 131.583L55.5084 130.407Z"
                                  fill="#0C62FD"/>
                            <path d="M52.6052 115.098L54.1272 116.643L46.412 124.242L45.0849 122.895L46.5612 114.341L46.5191 114.298L41.4932 119.249L39.9712 117.704L47.6864 110.104L49.003 111.441L47.5053 120.027L47.5527 120.075L52.6052 115.098Z"
                                  fill="#0C62FD"/>
                            <path d="M45.5722 106.822L46.8663 108.683L37.9756 114.866L36.6815 113.005L45.5722 106.822Z"
                                  fill="#0C62FD"/>
                            <path d="M41.9655 100.471L43.1685 102.937L34.9947 110.992L33.8776 108.702L40.4566 102.725L40.4335 102.677L31.6731 104.183L30.5858 101.954L41.9655 100.471Z"
                                  fill="#0C62FD"/>
                            <path d="M36.7512 89.8302L38.5727 89.3802L40.2934 96.3454L29.7801 98.9427L28.0594 91.9775L29.8735 91.5293L31.0506 96.2942L33.5861 95.6678L32.4755 91.1725L34.1658 90.755L35.2764 95.2503L37.9284 94.5951L36.7512 89.8302Z"
                                  fill="#0C62FD"/>
                            <path d="M29.3121 86.1031L32.7469 85.9702L32.6717 84.0288C32.6278 82.8938 31.9525 82.2544 30.8847 82.2957C29.8394 82.3362 29.1945 83.0641 29.2379 84.1841L29.3121 86.1031ZM34.3821 85.9069L38.3246 85.7543L38.4119 88.0093L27.6372 88.4263L27.4665 84.0134C27.3705 81.5344 28.6223 80.0651 30.7503 79.9828C32.1317 79.9293 33.3541 80.5999 33.8875 81.8206L38.0781 79.3851L38.1769 81.9387L34.3122 84.0999L34.3821 85.9069Z"
                                  fill="#0C62FD"/>
                            <path d="M34.982 78.2693L35.3651 76.11C36.2666 76.1627 37.0086 75.3453 37.2192 74.158C37.4312 72.9634 37.0046 72.0458 36.218 71.9062C35.5205 71.7825 35.0438 72.226 34.5254 73.4658L33.9737 74.8069C33.2005 76.7057 32.0263 77.5 30.4606 77.2222C28.4868 76.8721 27.4836 74.9337 27.9075 72.5443C28.3498 70.0511 29.9113 68.7131 31.8546 69.0196L31.4821 71.1196C30.5636 71.0332 29.8737 71.7298 29.6749 72.8502C29.4787 73.9559 29.8739 74.7914 30.6679 74.9322C31.3283 75.0494 31.7915 74.5958 32.292 73.414L32.7969 72.1642C33.6374 70.1013 34.7234 69.3296 36.3559 69.6192C38.4336 69.9878 39.4482 71.9052 38.9769 74.5617C38.5201 77.1366 37.0048 78.5593 34.982 78.2693Z"
                                  fill="#0C62FD"/>
                            <path d="M40.9062 66.9822L40.1753 69.1275L29.9245 65.6352L30.6554 63.4899L40.9062 66.9822Z"
                                  fill="#0C62FD"/>
                            <path d="M43.5831 61.1086L42.5474 63.1246L34.5771 59.0296L33.1469 61.8132L31.4848 60.9592L35.3843 53.3694L37.0464 54.2234L35.6128 57.0137L43.5831 61.1086Z"
                                  fill="#0C62FD"/>
                            <path d="M48.99 53.3398L47.5367 55.084L44.4237 52.4903L36.787 51.0395L38.3702 49.1393L43.4822 50.2381L43.5159 50.1977L41.5173 45.3621L43.0764 43.4909L45.877 50.7461L48.99 53.3398Z"
                                  fill="#0C62FD"/>
                            <path d="M53.2416 35.6096L56.5886 41.5022C57.2743 42.7094 58.4341 43.095 59.7001 42.3759C60.9595 41.6605 61.2223 40.4669 60.5366 39.2597L57.1896 33.3671L59.1603 32.2477L62.6185 38.3361C63.7972 40.4112 63.068 42.6983 60.6601 44.066C58.2456 45.4374 55.9078 44.8924 54.7291 42.8173L51.2709 36.729L53.2416 35.6096Z"
                                  fill="#0C62FD"/>
                            <path d="M68.0083 40.4766L65.9228 41.0691L62.9642 30.6563L64.7826 30.1396L71.5736 35.5408L71.6314 35.5244L69.704 28.7412L71.7895 28.1487L74.7481 38.5615L72.9441 39.0741L66.1357 33.6389L66.0707 33.6573L68.0083 40.4766Z"
                                  fill="#0C62FD"/>
                            <path d="M78.6267 38.3245L76.3776 38.5751L75.1802 27.8285L77.4293 27.5779L78.6267 38.3245Z"
                                  fill="#0C62FD"/>
                            <path d="M85.875 38.327L83.1563 38.1972L80.0483 27.2462L82.5728 27.3668L84.634 35.9396L84.6863 35.9421L87.5548 27.6046L90.0122 27.7219L85.875 38.327Z"
                                  fill="#0C62FD"/>
                            <path d="M97.7813 38.8058L97.2975 40.6185L90.3655 38.7685L93.158 28.3054L100.09 30.1554L99.6081 31.9609L94.8659 30.6953L94.1925 33.2186L98.6663 34.4126L98.2174 36.0948L93.7435 34.9008L93.0391 37.5402L97.7813 38.8058Z"
                                  fill="#0C62FD"/>
                            <path d="M104.708 34.0027L103.158 37.0872L104.901 37.9634C105.921 38.4757 106.811 38.1922 107.293 37.2333C107.764 36.2946 107.437 35.3743 106.432 34.8688L104.708 34.0027ZM102.42 38.5557L100.641 42.0962L98.6155 41.0785L103.479 31.4024L107.441 33.3941C109.668 34.513 110.352 36.3268 109.392 38.2378C108.768 39.4784 107.585 40.2277 106.253 40.1041L106.36 44.9709L104.067 43.8183L104.043 39.3713L102.42 38.5557Z"
                                  fill="#0C62FD"/>
                            <path d="M108.727 42.885L110.422 44.2615C109.941 45.021 110.295 46.0621 111.227 46.8189C112.165 47.5805 113.17 47.6522 113.671 47.0346C114.116 46.487 113.96 45.8576 113.131 44.8073L112.229 43.6791C110.949 42.0887 110.824 40.6825 111.823 39.4532C113.081 37.9034 115.253 37.966 117.129 39.4891C119.087 41.0785 119.498 43.0846 118.293 44.6289L116.644 43.2902C117.163 42.5321 116.889 41.5948 116.01 40.8805C115.141 40.1757 114.223 40.1163 113.717 40.7397C113.296 41.2583 113.467 41.8807 114.254 42.8873L115.099 43.9307C116.49 45.659 116.637 46.9775 115.596 48.2593C114.272 49.8906 112.112 49.8481 110.026 48.1546C108.005 46.5132 107.498 44.5065 108.727 42.885Z"
                                  fill="#0C62FD"/>
                            <path d="M115.775 53.4629L114.252 51.7844L122.273 44.5077L123.795 46.1862L115.775 53.4629Z"
                                  fill="#0C62FD"/>
                            <path d="M119.633 58.6513L118.368 56.7705L125.804 51.7706L124.058 49.1736L125.609 48.1309L130.37 55.2119L128.819 56.2546L127.069 53.6514L119.633 58.6513Z"
                                  fill="#0C62FD"/>
                            <path d="M123.824 67.117L122.987 65.0106L126.747 63.5177L131.662 57.5126L132.573 59.8073L129.171 63.7663L129.191 63.8152L134.385 64.369L135.282 66.6289L127.583 65.6242L123.824 67.117Z"
                                  fill="#0C62FD"/>
                            <path d="M137.304 79.4457L130.528 79.5174C129.14 79.5321 128.24 80.3597 128.256 81.8156C128.271 83.2639 129.188 84.0723 130.576 84.0576L137.353 83.9858L137.377 86.2521L130.375 86.3262C127.989 86.3515 126.342 84.6053 126.312 81.8362C126.283 79.0595 127.893 77.2788 130.279 77.2535L137.28 77.1793L137.304 79.4457Z"
                                  fill="#0C62FD"/>
                            <path d="M125.895 89.9866L126.379 87.8745L136.925 90.2909L136.503 92.1326L128.505 95.4843L128.491 95.5427L135.361 97.1168L134.877 99.2289L124.331 96.8125L124.75 94.9855L132.787 91.6348L132.802 91.569L125.895 89.9866Z"
                                  fill="#0C62FD"/>
                            <path d="M122.683 100.349L123.552 98.2558L133.554 102.406L132.686 104.499L122.683 100.349Z"
                                  fill="#0C62FD"/>
                            <path d="M119.193 106.729L120.628 104.405L131.755 106.999L130.422 109.157L121.892 106.8L121.865 106.844L127.791 113.416L126.493 115.517L119.193 106.729Z"
                                  fill="#0C62FD"/>
                            <path d="M112.99 116.813L111.642 115.518L116.594 110.363L124.376 117.837L119.424 122.993L118.081 121.703L121.469 118.176L119.592 116.374L116.396 119.701L115.145 118.499L118.341 115.172L116.378 113.286L112.99 116.813Z"
                                  fill="#0C62FD"/>
                            <path d="M113.856 125.254L111.904 122.407L110.294 123.51C109.353 124.155 109.172 125.071 109.778 125.956C110.372 126.823 111.336 126.981 112.265 126.344L113.856 125.254ZM110.975 121.051L108.734 117.782L110.604 116.501L116.726 125.434L113.068 127.941C111.013 129.35 109.094 129.073 107.885 127.308C107.1 126.163 107.015 124.765 107.767 123.659L103.454 121.402L105.571 119.95L109.477 122.078L110.975 121.051Z"
                                  fill="#0C62FD"/>
                            <path d="M104.114 124.483L102.089 125.295C101.659 124.506 100.578 124.309 99.4645 124.755C98.3439 125.205 97.7931 126.048 98.089 126.786C98.3513 127.44 98.9767 127.609 100.297 127.395L101.72 127.156C103.73 126.81 105.019 127.384 105.608 128.853C106.35 130.704 105.24 132.571 102.999 133.47C100.66 134.408 98.709 133.792 97.9457 131.99L99.9155 131.2C100.326 132.021 101.277 132.237 102.328 131.816C103.365 131.4 103.863 130.627 103.564 129.882C103.316 129.263 102.689 129.11 101.428 129.309L100.106 129.54C97.9217 129.915 96.6986 129.403 96.0846 127.872C95.3031 125.923 96.3891 124.058 98.881 123.058C101.296 122.09 103.295 122.622 104.114 124.483Z"
                                  fill="#0C62FD"/>
                            <path d="M91.4785 125.571L93.6833 125.046L96.1906 135.581L93.9857 136.106L91.4785 125.571Z"
                                  fill="#0C62FD"/>
                            <path d="M85.0711 126.445L87.3283 126.245L88.1213 135.169L91.2381 134.892L91.4034 136.753L82.9053 137.508L82.7399 135.647L85.8641 135.37L85.0711 126.445Z"
                                  fill="#0C62FD"/>
                            <path d="M75.6544 125.973L77.8976 126.258L77.3902 130.261L80.2681 137.448L77.8243 137.139L76.005 132.259L75.953 132.253L72.9666 136.523L70.56 136.218L75.1471 129.977L75.6544 125.973Z"
                                  fill="#0C62FD"/>
                        </svg>
                    </div>
                    <p>
						<?= $content->post_excerpt; ?>
                    </p>
                </div>
            </div>
		<?php endif ?>
    </div>
    <script>
      jQuery(function ($) {
        function loadCategoryContent(categoryId, categorySlug) {
          const ajaxUrl = '<?php echo admin_url( 'admin-ajax.php' ); ?>';
          const data = {
            action: 'load_posts_by_category',
            category_id: categoryId,
            category: categorySlug,
          };
          $.ajax({
            url: ajaxUrl,
            type: 'POST',
            data: data,
            success: function(response) {
              $('.category-posts').removeClass('container-glossary');
              $('.category-posts').html(response);
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.error('AJAX request failed: ' + textStatus, errorThrown);
              // Виведіть додаткову інформацію про помилку, якщо необхідно
              console.log(jqXHR.responseText);
            }
          });
        }

        function loadGlossaryTemplate() {
          const ajaxUrl = '<?php echo admin_url( 'admin-ajax.php' ); ?>';
          const data = {
            action: 'load_glossary_template'
          };
          $.ajax({
            url: ajaxUrl,
            type: 'POST',
            data: data,
            success: function(response) {
              $('.category-posts').addClass('container-glossary');
              $('.category-posts').html(response);
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.error('AJAX request failed: ' + textStatus, errorThrown);
              console.log(jqXHR.responseText);
            }
          });
        }

        var urlParams = new URLSearchParams(window.location.search);
        var glossaryParam = urlParams.get('glossary');
        if (glossaryParam) {
          loadGlossaryTemplate();
          $('.glossary-link').addClass('active');
        }

        $('.glossary-link').on('click', function (e) {
          e.preventDefault();
          var newURL = window.location.pathname + '?glossary';
          history.pushState(null, null, newURL);
          loadGlossaryTemplate();
          $('.category-link').removeClass('active');
          $(this).addClass('active');
        });

        $('.category-link').on('click', function (e) {
          e.preventDefault();
          var categoryId = $(this).data('category-id');
          var categorySlug = $(this).data('category-slug');
          var newURL = window.location.pathname + '?category=' + categorySlug;
          history.pushState(null, null, newURL);
          $('.category-link').removeClass('active');
          $('.glossary-link').removeClass('active');
          $('.category-posts').removeClass('container-glossary');
          $(this).addClass('active');
          loadCategoryContent(categoryId, categorySlug);
        });
      });
    </script>

</div>
<?php
wp_reset_postdata();
?>
<?php get_footer( 'media' ); ?>
